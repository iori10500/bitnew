(function(a){var b=a("script").last().attr("src"),s,e={style:"default",title:null,fixed:true,center:true,display:true,x:0,y:0,modal:true,modalClose:true,resize:true,unload:false,escHide:true,delayClose:0,drag:false,width:"",height:"",dataEle:"",locate:["left","top"],show:["fadeIn","normal"],hide:["fadeOut","normal"],actions:["minimize","maximize","close"],tools:false,buttons:{},beforeShow:a.noop,afterShow:a.noop,afterHide:a.noop,beforeUnload:a.noop,afterDrag:a.noop},x=2013,k={},l={},w=['<div class="thinkbox" style="position:fixed">','<table cellspacing="0" cellpadding="0" border="0">',"<tr>",'<td class="thinkbox-top-left"></td>','<td class="thinkbox-top"></td>','<td class="thinkbox-top-right"></td>',"</tr>","<tr>",'<td class="thinkbox-left"></td>','<td class="thinkbox-inner">','<div class="thinkbox-title"></div>','<div class="thinkbox-body"></div>','<div class="thinkbox-tools"></div>',"</td>",'<td class="thinkbox-right"></td>',"</tr>","<tr>",'<td class="thinkbox-bottom-left"></td>','<td class="thinkbox-bottom"></td>','<td class="thinkbox-bottom-right"></td>',"</tr>","</table>","</div>"].join(""),c=a(document),d=a(window);function j(y,z){var A=b.slice(0,b.lastIndexOf("/"));if(a("link[href='"+A+y+"']").length){h(z);return}a("<link/>").load(function(){h(z)}).attr({href:A+y+"?"+Math.random(),type:"text/css",rel:"stylesheet"}).appendTo("head")}function v(){return{width:d.width(),height:d.height(),left:d.scrollLeft(),top:d.scrollTop()}}function h(z,y){if(a.isFunction(z)){return z.call(this,y)}}function f(z,A){if(a.isArray(z)){for(i in z){y(z[i])}}else{y(z)}function y(B){if(B in A){delete A[B]}}}function u(){var y=a("body")[0];y.onselectstart=function(){return false};y.unselectable="on";y.style.MozUserSelect="none";y.style.WebkitUserSelect="none"}function m(){var y=a("body")[0];y.onselectstart=function(){return true};y.unselectable="off";y.style.MozUserSelect="";y.style.WebkitUserSelect=""}function n(){var z=l[this.key][0],y=l[this.key][1];if(l.current!=this.key){l.current=this.key;z.modal&&y.data("ThinkBoxModal").css({zIndex:x-1});y.css({zIndex:x++})}}function t(){var z=l[this.key][0],y=l[this.key][1];h.call(this,z.beforeUnload);z.modal&&y.data("ThinkBoxModal").remove();y.remove();d.off("resize."+this.key);delete l[this.key];z.dataEle&&a(z.dataEle).removeData("ThinkBox")}function o(){var B=this,A=l[this.key][0],y=l[this.key][1],z=y.data("ThinkBoxModal");if(z){z.show();return}z=a('<div class="thinkbox-modal-blackout-'+A.style+'"></div>').css({zIndex:x++,position:"fixed",left:0,top:0,right:0,bottom:0}).click(function(C){A.modalClose&&l.current==B.key&&B.hide();C.stopPropagation()}).mousedown(function(C){C.stopPropagation()}).appendTo(a("body"));y.data("ThinkBoxModal",z)}function p(){var z=a(".thinkbox-title",l[this.key][1]),y=l[this.key][0];if(y.title){if(y.drag){z.addClass("thinkbox-draging");g.call(this,z)}this.setTitle(y.title);r.call(this,z)}else{z.remove()}}function r(D){var z,A,y,B=l[this.key][0],C=this;if(B.actions&&a.isArray(B.actions)){z=a("<div/>").addClass("thinkbox-window-actions").appendTo(D).on("click","button",function(){if(!a(this).hasClass("disabled")){switch(this.name){case"minimize":C.minimize(this);break;case"maximize":C.maximize(this);break;case"close":C.hide();break}}}).on("mousedown mouseup",function(E){E.stopPropagation()});for(i in B.actions){A=B.actions[i];y=a("<button/>").appendTo(z).addClass("thinkbox-actions-"+A).attr("name",A).attr("title",A).text(k[A]||A)}}}function g(C){var z=null,B=this,A=l[this.key][0],y=l[this.key][1];c.mousemove(function(D){z&&y.css({left:D.pageX-z[0],top:D.pageY-z[1]})});C.mousedown(function(D){var E=y.offset();if(A.fixed){E.left-=d.scrollLeft();E.top-=d.scrollTop()}u();z=[D.pageX-E.left,D.pageY-E.top]}).mouseup(function(){z=null;m();h.call(B,A.afterDrag)})}function q(){var B=a(".thinkbox-tools",l[this.key][1]),z=l[this.key][0],y,A=this;if(z.tools){if(z.buttons&&a.isPlainObject(z.buttons)){for(name in z.buttons){this.addToolsButton(name,z.buttons[name])}B.on("click","button",function(){if(!a(this).hasClass("disabled")){if(false===z.buttons[this.name][2].call(A)){return}switch(this.name){case"close":case"cancel":A.hide(false);break;case"submit":A.find("form").submit();break}}})}}else{B.remove()}}s=function(A,B){var C=this,B,y,z;B=a.extend({},e,B||{});y=a(w).addClass("thinkbox-"+B.style).data("thinkbox",C);this.key="thinkbox_"+new Date().getTime()+(Math.random()+"").substr(2,12);l[this.key]=[B,y];B.dataEle&&a(B.dataEle).data("thinkbox",C);y.on("click mousedown",function(D){n.call(C);D.stopPropagation()});B.fixed||y.css("position","absolute");p.call(C);q.call(C);j("/skin/"+B.style+"/style.css",function(){y.hide().appendTo("body");z=a(".thinkbox-left",y).width();z&&a(".thinkbox-left",y).append(a("<div/>").css("width",z));C.setSize(B.width,B.height);C.setContent(A||"<div></div>");B.display&&C.show()})};s.prototype={show:function(){var B=this,A=l[this.key][0],z=l[this.key][1];if(z.is(":visible")){return this}A.modal&&o.call(this);h.call(this,A.beforeShow);switch(A.show[0]){case"slideDown":z.stop(true,true).slideDown(A.show[1],y);break;case"fadeIn":z.stop(true,true).fadeIn(A.show[1],y);break;default:z.show(A.show[1],y)}A.resize&&d.on("resize."+B.key,function(){B.setSize(A.width,A.height);B.resetLocate()});n.call(this);return this;function y(){A.delayClose&&a.isNumeric(A.delayClose)&&setTimeout(function(){B.hide()},A.delayClose);h.call(B,A.afterShow)}},hide:function(A){var D=this,C=l[this.key][0],z=l[this.key][1],B;if(!z.is(":visible")){return this}B=z.data("ThinkBoxModal");B&&B.fadeOut();switch(C.hide[0]){case"slideUp":z.stop(true,true).slideUp(C.hide[1],y);break;case"fadeOut":z.stop(true,true).fadeOut(C.hide[1],y);break;default:z.hide(C.hide[1],y)}return this;function y(){h.call(D,C.afterHide,A);C.unload&&t.call(D)}},toggle:function(){return l[this.key][1].is(":visible")?self.hide():self.show()},find:function(z){var y=a(".thinkbox-body",l[this.key][1]);return z?a(z,y):y.children()},getContent:function(){return a(".thinkbox-body",l[this.key][1]).html()},setContent:function(y){var z=l[this.key][0];a(".thinkbox-body",l[this.key][1]).empty().append(a(y).show());this.resetLocate();return this},setSize:function(z,y){var z=a.isFunction(z)?z.call(this):z,y=a.isFunction(y)?y.call(this):y;a(".thinkbox-body",l[this.key][1]).css({width:z,height:y});return this},moveToCenter:function(){var A=this.getSize(),B=v(),z=l[this.key][1].css("position")=="fixed"?[0,0]:[B.left,B.top],C=z[0]+B.width/2,D=z[1]+B.height/2;this.moveTo(C-A[0]/2,D-A[1]/2);return this},moveTo:function(B,C){var z=l[this.key][1],A=l[this.key][0];a.isNumeric(B)&&(A.locate[0]=="left"?z.css({left:B}):z.css({right:B}));a.isNumeric(C)&&(A.locate[1]=="top"?z.css({top:C}):z.css({bottom:C}));return this},getSize:function(){var z=[0,0],y=l[this.key][1];if(y.is(":visible")){z=[y.width(),y.height()]}else{y.css({visibility:"hidden",display:"block"});z=[y.width(),y.height()];y.css({visibility:"visible",display:"none"})}return z},setTitle:function(y){a(".thinkbox-title",l[this.key][1]).empty().append("<span>"+y+"</span>");return this},resetLocate:function(){var y=l[this.key][0];y.center?this.moveToCenter():this.moveTo(a.isNumeric(y.x)?y.x:(a.isFunction(y.x)?y.x.call(a(y.dataEle)):0),a.isNumeric(y.y)?y.y:(a.isFunction(y.y)?y.y.call(a(y.dataEle)):0));return this},setStatus:function(z,A){var B=l[this.key][0],y=l[this.key][1],A=A?"thinkbox-status-"+A:"",C;if(B.tools){a(".thinkbox-status",y).remove();C=a('<div class="thinkbox-status">').addClass(A).html(z);a(".thinkbox-tools",y).prepend(C)}return this},addToolsButton:function(B,A){var C=l[this.key][0],y=l[this.key][1],z;if(C.tools){z=a("<button/>").attr("name",B).text(A[0]);A[1]&&z.addClass("thinkbox-button-"+A[1]);if(!a.isFunction(A[2])){A[2]=a.noop}a(".thinkbox-tools",y).append(z)}return this},setToolsButton:function(C,B,A){var D=l[this.key][0],y=l[this.key][1],z;z=a(".thinkbox-tools",y).find("button[name="+C+"]",y).attr("name",B).text(A[0]);D.buttons[B]=A;A[1]&&z.removeClass().addClass("thinkbox-button-"+A[1]);if(!a.isFunction(A[2])){A[2]=a.noop}return this},removeToolsButton:function(y){a(".thinkbox-tools",l[this.key][1]).find("button[name='"+y+"']").remove();return this},disableToolsButton:function(y){a(".thinkbox-tools",l[this.key][1]).find("button[name='"+y+"']").addClass("disabled").attr("disabled","disabled");return this},enableToolsButton:function(y){a(".thinkbox-tools",l[this.key][1]).find("button[name='"+y+"']").removeClass("disabled").removeAttr("disabled","disabled");return this},minimize:function(){return this},maximize:function(){return this}};c.mousedown(function(){l.current=null}).keydown(function(y){l.current&&l[l.current][0].escHide&&y.keyCode==27&&l[l.current][1].data("thinkbox").hide()});a.thinkbox=function(z,A){if(a.isPlainObject(A)&&A.dataEle){var y=a(A.dataEle).data("thinkbox");if(y){return A.display===false?y:y.show()}}return new s(z,A)};a.extend(a.thinkbox,{defaults:function(y,z){if(a.isPlainObject(y)){a.extend(e,y)}else{e[y]=z}},load:function(E,B){var C={clone:false,loading:"加载中...",type:"GET",dataType:"text",cache:false,onload:undefined},D,y,A,z,E=E.split(/\s+/);a.extend(C,B||{});A=C.onload;z=C.loading;y={data:C.data,type:C.type,dataType:C.dataType,cache:C.cache,success:function(F){E[1]&&(F=a(F).find(E[1]));if(a.isFunction(A)){F=h.call(D,A,F)}D.setContent(F);z||D.show()}};f(["data","type","cache","dataType","onload","loading"],C);D=z?a.thinkbox('<div class="thinkbox-load-loading">'+z+"</div>",C):a.thinkbox("<div/>",a.extend({},C,{display:false}));a.ajax(E[0],y);return D},iframe:function(D,A){var B={width:500,height:400,scrolling:"no",onload:undefined},C,y,z;a.extend(B,A||{});z=B.onload;y=a("<iframe/>").attr({width:B.width,height:B.height,frameborder:0,scrolling:B.scrolling,src:D}).load(function(){h.call(C,z)});f(["width","height","scrolling","onload"],B);C=a.thinkbox(y,B);return C},tips:function(z,C,A){var B={modalClose:false,escHide:false,unload:true,close:false,delayClose:1000},y;switch(C){case 0:C="error";break;case 1:C="success";break}y='<div class="thinkbox-tips thinkbox-tips-'+C+'">'+z+"</div>";a.extend(B,A||{});return a.thinkbox(y,B)},success:function(y,z){return this.tips(y,"success",z)},error:function(y,z){return this.tips(y,"error",z)},loading:function(y,z){var A=z||{};A.delayClose=0;return this.tips(y,"loading",A)},msg:function(z,A){var B={drag:false,escHide:false,delayClose:0,center:false,title:"消息",x:0,y:0,locate:["right","bottom"],show:["slideDown","slow"],hide:["slideUp","slow"]},y;a.extend(B,A||{});y=a("<div/>").addClass("thinkbox-msg").html(z);return a.thinkbox(y,B)},alert:function(z,A){var B={title:k.alert||"Alert",modal:true,modalClose:false,unload:false,tools:true,actions:["close"],buttons:{ok:[k.ok||"Ok","blue",function(){this.hide()}]}};a.extend(B,A||{});f("ok",B);var y=a("<div/>").addClass("thinkbox-alert").html(z);return a.thinkbox(y,B)},confirm:function(A,B){var C={title:"确认",modal:false,modalClose:false},y={ok:"确定",cancel:"取消"};a.extend(C,B||{});C.ok&&(y.ok=C.ok);C.cancel&&(y.cancel=C.cancel);f(["ok","cancel"],C);C.buttons=y;var z=a("<div/>").addClass("thinkbox-confirm").html(A);return a.thinkbox(z,C)},get:function(y){return a(y).closest(".thinkbox").data("thinkbox")}});a.fn.thinkbox=function(z){if(z=="get"){return a(this).data("thinkbox")}return this.each(function(){var D=a(this),A=D.data("thinkbox"),C,B;switch(z){case"show":A&&A.show();break;case"hide":A&&A.hide();break;case"toggle":A&&A.toggle();break;default:C={title:D.attr("title"),dataEle:this,fixed:false,center:false,modal:false,drag:false};z=a.isPlainObject(z)?z:{};a.extend(C,{x:function(){return a(this).offset().left},y:function(){return a(this).offset().top+a(this).outerHeight()}},z);if(C.event){D.on(B,function(){y.call(D,C);return false})}else{y.call(D,C)}}});function y(B){var A=this.data("href")||this.attr("href");if(A.substr(0,1)=="#"){a.thinkbox(A,B)}else{if(A.substr(0,7)=="http://"||A.substr(0,8)=="https://"){a.thinkbox.iframe(A,B)}else{a.thinkbox.load(A,B)}}}}})(jQuery);