KindEditor.plugin("flash",function(f){var i=this,h="flash",g=i.lang(h+"."),b=f.undef(i.allowFlashUpload,true),a=f.undef(i.allowFileManager,false),e=f.undef(i.formatUploadUrl,true),c=f.undef(i.extraFileUploadParams,{}),d=f.undef(i.filePostName,"imgFile"),j=f.undef(i.uploadJson,i.basePath+"php/upload_json.php");i.plugin.flash={edit:function(){var o=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+g.url+"</label>",'<input class="ke-input-text" type="text" id="keUrl" name="url" value="" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+g.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+g.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keWidth" style="width:60px;">'+g.width+"</label>",'<input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="550" maxlength="4" /> ',"</div>",'<div class="ke-dialog-row">','<label for="keHeight" style="width:60px;">'+g.height+"</label>",'<input type="text" id="keHeight" class="ke-input-text ke-input-number" name="height" value="400" maxlength="4" /> ',"</div>","</div>"].join("");var l=i.createDialog({name:h,width:450,title:i.lang(h),body:o,yesBtn:{name:i.lang("yes"),click:function(u){var x=f.trim(r.val()),y=t.val(),v=n.val();if(x=="http://"||f.invalidUrl(x)){alert(i.lang("invalidUrl"));r[0].focus();return}if(!/^\d*$/.test(y)){alert(i.lang("invalidWidth"));t[0].focus();return}if(!/^\d*$/.test(v)){alert(i.lang("invalidHeight"));n[0].focus();return}var w=f.mediaImg(i.themesPath+"common/blank.gif",{src:x,type:f.mediaType(".swf"),width:y,height:v,quality:"high"});i.insertHtml(w).hideDialog().focus()}}}),m=l.div,r=f('[name="url"]',m),s=f('[name="viewServer"]',m),t=f('[name="width"]',m),n=f('[name="height"]',m);r.val("http://");if(b){var q=f.uploadbutton({button:f(".ke-upload-button",m)[0],fieldName:d,extraParams:c,url:f.addParam(j,"dir=flash"),afterUpload:function(u){l.hideLoading();if(u.error===0){var v=u.url;if(e){v=f.formatUrl(v,"absolute")}r.val(v);if(i.afterUpload){i.afterUpload.call(i,v,u,h)}alert(i.lang("uploadSuccess"))}else{alert(u.message)}},afterError:function(u){l.hideLoading();i.errorDialog(u)}});q.fileBox.change(function(u){l.showLoading(i.lang("uploadLoading"));q.submit()})}else{f(".ke-upload-button",m).hide()}if(a){s.click(function(u){i.loadPlugin("filemanager",function(){i.plugin.filemanagerDialog({viewType:"LIST",dirName:"flash",clickFn:function(w,v){if(i.dialogs.length>1){f('[name="url"]',m).val(w);if(i.afterSelectFile){i.afterSelectFile.call(i,w)}i.hideDialog()}}})})})}else{s.hide()}var p=i.plugin.getSelectedFlash();if(p){var k=f.mediaAttrs(p.attr("data-ke-tag"));r.val(k.src);t.val(f.removeUnit(p.css("width"))||k.width||0);n.val(f.removeUnit(p.css("height"))||k.height||0)}r[0].focus();r[0].select()},"delete":function(){i.plugin.getSelectedFlash().remove()}};i.clickToolbar(h,i.plugin.flash.edit)});