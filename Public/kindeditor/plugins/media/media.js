KindEditor.plugin("media",function(f){var i=this,h="media",g=i.lang(h+"."),b=f.undef(i.allowMediaUpload,true),a=f.undef(i.allowFileManager,false),e=f.undef(i.formatUploadUrl,true),c=f.undef(i.extraFileUploadParams,{}),d=f.undef(i.filePostName,"imgFile"),j=f.undef(i.uploadJson,i.basePath+"php/upload_json.php");i.plugin.media={edit:function(){var p=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+g.url+"</label>",'<input class="ke-input-text" type="text" id="keUrl" name="url" value="" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+g.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+g.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keWidth" style="width:60px;">'+g.width+"</label>",'<input type="text" id="keWidth" class="ke-input-text ke-input-number" name="width" value="550" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keHeight" style="width:60px;">'+g.height+"</label>",'<input type="text" id="keHeight" class="ke-input-text ke-input-number" name="height" value="400" maxlength="4" />',"</div>",'<div class="ke-dialog-row">','<label for="keAutostart">'+g.autostart+"</label>",'<input type="checkbox" id="keAutostart" name="autostart" value="" /> ',"</div>","</div>"].join("");var m=i.createDialog({name:h,width:450,height:230,title:i.lang(h),body:p,yesBtn:{name:i.lang("yes"),click:function(v){var y=f.trim(s.val()),z=u.val(),w=o.val();if(y=="http://"||f.invalidUrl(y)){alert(i.lang("invalidUrl"));s[0].focus();return}if(!/^\d*$/.test(z)){alert(i.lang("invalidWidth"));u[0].focus();return}if(!/^\d*$/.test(w)){alert(i.lang("invalidHeight"));o[0].focus();return}var x=f.mediaImg(i.themesPath+"common/blank.gif",{src:y,type:f.mediaType(y),width:z,height:w,autostart:l[0].checked?"true":"false",loop:"true"});i.insertHtml(x).hideDialog().focus()}}}),n=m.div,s=f('[name="url"]',n),t=f('[name="viewServer"]',n),u=f('[name="width"]',n),o=f('[name="height"]',n),l=f('[name="autostart"]',n);s.val("http://");if(b){var r=f.uploadbutton({button:f(".ke-upload-button",n)[0],fieldName:d,extraParams:c,url:f.addParam(j,"dir=media"),afterUpload:function(v){m.hideLoading();if(v.error===0){var w=v.url;if(e){w=f.formatUrl(w,"absolute")}s.val(w);if(i.afterUpload){i.afterUpload.call(i,w,v,h)}alert(i.lang("uploadSuccess"))}else{alert(v.message)}},afterError:function(v){m.hideLoading();i.errorDialog(v)}});r.fileBox.change(function(v){m.showLoading(i.lang("uploadLoading"));r.submit()})}else{f(".ke-upload-button",n).hide()}if(a){t.click(function(v){i.loadPlugin("filemanager",function(){i.plugin.filemanagerDialog({viewType:"LIST",dirName:"media",clickFn:function(x,w){if(i.dialogs.length>1){f('[name="url"]',n).val(x);if(i.afterSelectFile){i.afterSelectFile.call(i,x)}i.hideDialog()}}})})})}else{t.hide()}var q=i.plugin.getSelectedMedia();if(q){var k=f.mediaAttrs(q.attr("data-ke-tag"));s.val(k.src);u.val(f.removeUnit(q.css("width"))||k.width||0);o.val(f.removeUnit(q.css("height"))||k.height||0);l[0].checked=(k.autostart==="true")}s[0].focus();s[0].select()},"delete":function(){i.plugin.getSelectedMedia().remove()}};i.clickToolbar(h,i.plugin.media.edit)});