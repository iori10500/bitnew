KindEditor.plugin("insertfile",function(f){var i=this,h="insertfile",b=f.undef(i.allowFileUpload,true),a=f.undef(i.allowFileManager,false),e=f.undef(i.formatUploadUrl,true),j=f.undef(i.uploadJson,i.basePath+"php/upload_json.php"),c=f.undef(i.extraFileUploadParams,{}),d=f.undef(i.filePostName,"imgFile"),g=i.lang(h+".");i.plugin.fileDialog=function(q){var o=f.undef(q.fileUrl,"http://"),n=f.undef(q.fileTitle,""),k=q.clickFn;var p=['<div style="padding:20px;">','<div class="ke-dialog-row">','<label for="keUrl" style="width:60px;">'+g.url+"</label>",'<input type="text" id="keUrl" name="url" class="ke-input-text" style="width:160px;" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+g.upload+'" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+g.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="keTitle" style="width:60px;">'+g.title+"</label>",'<input type="text" id="keTitle" class="ke-input-text" name="title" value="" style="width:160px;" /></div>',"</div>","</form>","</div>"].join("");var l=i.createDialog({name:h,width:450,title:i.lang(h),body:p,yesBtn:{name:i.lang("yes"),click:function(v){var x=f.trim(t.val()),w=r.val();if(x=="http://"||f.invalidUrl(x)){alert(i.lang("invalidUrl"));t[0].focus();return}if(f.trim(w)===""){w=x}k.call(i,x,w)}}}),m=l.div;var t=f('[name="url"]',m),u=f('[name="viewServer"]',m),r=f('[name="title"]',m);if(b){var s=f.uploadbutton({button:f(".ke-upload-button",m)[0],fieldName:d,url:f.addParam(j,"dir=file"),extraParams:c,afterUpload:function(v){l.hideLoading();if(v.error===0){var w=v.url;if(e){w=f.formatUrl(w,"absolute")}t.val(w);if(i.afterUpload){i.afterUpload.call(i,w,v,h)}alert(i.lang("uploadSuccess"))}else{alert(v.message)}},afterError:function(v){l.hideLoading();i.errorDialog(v)}});s.fileBox.change(function(v){l.showLoading(i.lang("uploadLoading"));s.submit()})}else{f(".ke-upload-button",m).hide()}if(a){u.click(function(v){i.loadPlugin("filemanager",function(){i.plugin.filemanagerDialog({viewType:"LIST",dirName:"file",clickFn:function(x,w){if(i.dialogs.length>1){f('[name="url"]',m).val(x);if(i.afterSelectFile){i.afterSelectFile.call(i,x)}i.hideDialog()}}})})})}else{u.hide()}t.val(o);r.val(n);t[0].focus();t[0].select()};i.clickToolbar(h,function(){i.plugin.fileDialog({clickFn:function(m,l){var k='<a class="ke-insertfile" href="'+m+'" data-ke-src="'+m+'" target="_blank">'+l+"</a>";i.insertHtml(k).hideDialog().focus()}})})});