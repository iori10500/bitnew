KindEditor.plugin("filemanager",function(d){var h=this,g="filemanager",b=d.undef(h.fileManagerJson,h.basePath+"php/file_manager_json.php"),c=h.pluginsPath+g+"/images/",e=h.lang(g+".");function f(j,k,i){return j+" ("+Math.ceil(k/1024)+"KB, "+i+")"}function a(j,i){if(i.is_dir){j.attr("title",i.filename)}else{j.attr("title",f(i.filename,i.filesize,i.datetime))}}h.plugin.filemanagerDialog=function(w){var C=d.undef(w.width,650),s=d.undef(w.height,510),p=d.undef(w.dirName,""),A=d.undef(w.viewType,"VIEW").toUpperCase(),k=w.clickFn;var t=['<div style="padding:10px 20px;">','<div class="ke-plugin-filemanager-header">','<div class="ke-left">','<img class="ke-inline-block" name="moveupImg" src="'+c+'go-up.gif" width="16" height="16" border="0" alt="" /> ','<a class="ke-inline-block" name="moveupLink" href="javascript:;">'+e.moveup+"</a>","</div>",'<div class="ke-right">',e.viewType+' <select class="ke-inline-block" name="viewType">','<option value="VIEW">'+e.viewImage+"</option>",'<option value="LIST">'+e.listImage+"</option>","</select> ",e.orderType+' <select class="ke-inline-block" name="orderType">','<option value="NAME">'+e.fileName+"</option>",'<option value="SIZE">'+e.fileSize+"</option>",'<option value="TYPE">'+e.fileType+"</option>","</select>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<div class="ke-plugin-filemanager-body"></div>',"</div>"].join("");var o=h.createDialog({name:g,width:C,height:s,title:h.lang(g),body:t}),q=o.div,j=d(".ke-plugin-filemanager-body",q),u=d('[name="moveupImg"]',q),v=d('[name="moveupLink"]',q),z=d('[name="viewServer"]',q),B=d('[name="viewType"]',q),x=d('[name="orderType"]',q);function y(G,E,D){var F="path="+G+"&order="+E+"&dir="+p;o.showLoading(h.lang("ajaxLoading"));d.ajax(d.addParam(b,F+"&"+new Date().getTime()),function(H){o.hideLoading();D(H)})}var r=[];function i(G,I,E,D){var H=d.formatUrl(I.current_url+E.filename,"absolute"),F=encodeURIComponent(I.current_dir_path+E.filename+"/");if(E.is_dir){G.click(function(J){y(F,x.val(),D)})}else{if(E.is_photo){G.click(function(J){k.call(this,H,E.filename)})}else{G.click(function(J){k.call(this,H,E.filename)})}}r.push(G)}function l(F,E){d.each(r,function(){this.unbind()});v.unbind();B.unbind();x.unbind();if(F.current_dir_path){v.click(function(G){y(F.moveup_dir_path,x.val(),E)})}function D(){if(B.val()=="VIEW"){y(F.current_dir_path,x.val(),n)}else{y(F.current_dir_path,x.val(),m)}}B.change(D);x.change(D);j.html("")}function m(K){l(K,m);var M=document.createElement("table");M.className="ke-table";M.cellPadding=0;M.cellSpacing=0;M.border=0;j.append(M);var F=K.file_list;for(var G=0,J=F.length;G<J;G++){var E=F[G],L=d(M.insertRow(G));L.mouseover(function(N){d(this).addClass("ke-on")}).mouseout(function(N){d(this).removeClass("ke-on")});var H=c+(E.is_dir?"folder-16.gif":"file-16.gif"),I=d('<img src="'+H+'" width="16" height="16" alt="'+E.filename+'" align="absmiddle" />'),D=d(L[0].insertCell(0)).addClass("ke-cell ke-name").append(I).append(document.createTextNode(" "+E.filename));if(!E.is_dir||E.has_file){L.css("cursor","pointer");D.attr("title",E.filename);i(D,K,E,m)}else{D.attr("title",e.emptyFolder)}d(L[0].insertCell(1)).addClass("ke-cell ke-size").html(E.is_dir?"-":Math.ceil(E.filesize/1024)+"KB");d(L[0].insertCell(2)).addClass("ke-cell ke-datetime").html(E.datetime)}}function n(M){l(M,n);var F=M.file_list;for(var H=0,K=F.length;H<K;H++){var D=F[H],E=d('<div class="ke-inline-block ke-item"></div>');j.append(E);var L=d('<div class="ke-inline-block ke-photo"></div>').mouseover(function(N){d(this).addClass("ke-on")}).mouseout(function(N){d(this).removeClass("ke-on")});E.append(L);var G=M.current_url+D.filename,I=D.is_dir?c+"folder-64.gif":(D.is_photo?G:c+"file-64.gif");var J=d('<img src="'+I+'" width="80" height="80" alt="'+D.filename+'" />');if(!D.is_dir||D.has_file){L.css("cursor","pointer");a(L,D);i(L,M,D,n)}else{L.attr("title",e.emptyFolder)}L.append(J);E.append('<div class="ke-name" title="'+D.filename+'">'+D.filename+"</div>")}}B.val(A);y("",x.val(),A=="VIEW"?n:m);return o}});