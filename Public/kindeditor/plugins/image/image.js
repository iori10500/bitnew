KindEditor.plugin("image",function(j){var m=this,l="image",c=j.undef(m.allowImageUpload,true),b=j.undef(m.allowImageRemote,true),g=j.undef(m.formatUploadUrl,true),a=j.undef(m.allowFileManager,false),n=j.undef(m.uploadJson,m.basePath+"php/upload_json.php"),h=j.undef(m.imageTabIndex,0),i=m.pluginsPath+"image/images/",d=j.undef(m.extraFileUploadParams,{}),e=j.undef(m.filePostName,"imgFile"),f=j.undef(m.fillDescAfterUploadImage,false),k=m.lang(l+".");m.plugin.imageDialog=function(E){var A=E.imageUrl,B=j.undef(E.imageWidth,""),y=j.undef(E.imageHeight,""),z=j.undef(E.imageTitle,""),x=j.undef(E.imageAlign,""),K=j.undef(E.showRemote,true),J=j.undef(E.showLocal,true),L=j.undef(E.tabIndex,0),p=E.clickFn;var N="kindeditor_upload_iframe_"+new Date().getTime();var v=[];for(var C in d){v.push('<input type="hidden" name="'+C+'" value="'+d[C]+'" />')}var w=['<div style="padding:20px;">','<div class="tabs"></div>','<div class="tab1" style="display:none;">','<div class="ke-dialog-row">','<label for="remoteUrl" style="width:60px;">'+k.remoteUrl+"</label>",'<input type="text" id="remoteUrl" class="ke-input-text" name="url" value="" style="width:200px;" /> &nbsp;','<span class="ke-button-common ke-button-outer">','<input type="button" class="ke-button-common ke-button" name="viewServer" value="'+k.viewServer+'" />',"</span>","</div>",'<div class="ke-dialog-row">','<label for="remoteWidth" style="width:60px;">'+k.size+"</label>",k.width+' <input type="text" id="remoteWidth" class="ke-input-text ke-input-number" name="width" value="" maxlength="4" /> ',k.height+' <input type="text" class="ke-input-text ke-input-number" name="height" value="" maxlength="4" /> ','<img class="ke-refresh-btn" src="'+i+'refresh.png" width="16" height="16" alt="" style="cursor:pointer;" title="'+k.resetSize+'" />',"</div>",'<div class="ke-dialog-row">','<label style="width:60px;">'+k.align+"</label>",'<input type="radio" name="align" class="ke-inline-block" value="" checked="checked" /> <img name="defaultImg" src="'+i+'align_top.gif" width="23" height="25" alt="" />',' <input type="radio" name="align" class="ke-inline-block" value="left" /> <img name="leftImg" src="'+i+'align_left.gif" width="23" height="25" alt="" />',' <input type="radio" name="align" class="ke-inline-block" value="right" /> <img name="rightImg" src="'+i+'align_right.gif" width="23" height="25" alt="" />',"</div>",'<div class="ke-dialog-row">','<label for="remoteTitle" style="width:60px;">'+k.imgTitle+"</label>",'<input type="text" id="remoteTitle" class="ke-input-text" name="title" value="" style="width:200px;" />',"</div>","</div>",'<div class="tab2" style="display:none;">','<iframe name="'+N+'" style="display:none;"></iframe>','<form class="ke-upload-area ke-form" method="post" enctype="multipart/form-data" target="'+N+'" action="'+j.addParam(n,"dir=image")+'">','<div class="ke-dialog-row">',v.join(""),'<label style="width:60px;">'+k.localUrl+"</label>",'<input type="text" name="localUrl" class="ke-input-text" tabindex="-1" style="width:200px;" readonly="true" /> &nbsp;','<input type="button" class="ke-upload-button" value="'+k.upload+'" />',"</div>","</form>","</div>","</div>"].join("");var s=J||a?450:400,r=J&&K?300:250;var q=m.createDialog({name:l,width:s,height:r,title:m.lang(l),body:w,yesBtn:{name:m.lang("yes"),click:function(U){if(q.isLoading){return}if(J&&K&&M&&M.selectedIndex===1||!K){if(P.fileBox.val()==""){alert(m.lang("pleaseSelectFile"));return}q.showLoading(m.lang("uploadLoading"));P.submit();D.val("");return}var X=j.trim(Q.val()),Y=S.val(),V=u.val(),W=O.val(),T="";o.each(function(){if(this.checked){T=this.value;return false}});if(X=="http://"||j.invalidUrl(X)){alert(m.lang("invalidUrl"));Q[0].focus();return}if(!/^\d*$/.test(Y)){alert(m.lang("invalidWidth"));S[0].focus();return}if(!/^\d*$/.test(V)){alert(m.lang("invalidHeight"));u[0].focus();return}p.call(m,X,W,Y,V,0,T)}},beforeRemove:function(){R.unbind();S.unbind();u.unbind();H.unbind()}}),t=q.div;var Q=j('[name="url"]',t),D=j('[name="localUrl"]',t),R=j('[name="viewServer"]',t),S=j('.tab1 [name="width"]',t),u=j('.tab1 [name="height"]',t),H=j(".ke-refresh-btn",t),O=j('.tab1 [name="title"]',t),o=j('.tab1 [name="align"]',t);var M;if(K&&J){M=j.tabs({src:j(".tabs",t),afterSelect:function(T){}});M.add({title:k.remoteImage,panel:j(".tab1",t)});M.add({title:k.localImage,panel:j(".tab2",t)});M.select(L)}else{if(K){j(".tab1",t).show()}else{if(J){j(".tab2",t).show()}}}var P=j.uploadbutton({button:j(".ke-upload-button",t)[0],fieldName:e,form:j(".ke-form",t),target:N,width:60,afterUpload:function(T){q.hideLoading();if(T.error===0){var U=T.url;if(g){U=j.formatUrl(U,"absolute")}if(m.afterUpload){m.afterUpload.call(m,U,T,l)}if(!f){p.call(m,U,T.title,T.width,T.height,T.border,T.align)}else{j(".ke-dialog-row #remoteUrl",t).val(U);j(".ke-tabs-li",t)[0].click();j(".ke-refresh-btn",t).click()}}else{alert(T.message)}},afterError:function(T){q.hideLoading();m.errorDialog(T)}});P.fileBox.change(function(T){D.val(P.fileBox.val())});if(a){R.click(function(T){m.loadPlugin("filemanager",function(){m.plugin.filemanagerDialog({viewType:"VIEW",dirName:"image",clickFn:function(V,U){if(m.dialogs.length>1){j('[name="url"]',t).val(V);if(m.afterSelectFile){m.afterSelectFile.call(m,V)}m.hideDialog()}}})})})}else{R.hide()}var G=0,F=0;function I(U,T){S.val(U);u.val(T);G=U;F=T}H.click(function(T){var U=j('<img src="'+Q.val()+'" />',document).css({position:"absolute",visibility:"hidden",top:0,left:"-1000px"});U.bind("load",function(){I(U.width(),U.height());U.remove()});j(document.body).append(U)});S.change(function(T){if(G>0){u.val(Math.round(F/G*parseInt(this.value,10)))}});u.change(function(T){if(F>0){S.val(Math.round(G/F*parseInt(this.value,10)))}});Q.val(E.imageUrl);I(E.imageWidth,E.imageHeight);O.val(E.imageTitle);o.each(function(){if(this.value===E.imageAlign){this.checked=true;return false}});if(K&&L===0){Q[0].focus();Q[0].select()}return q};m.plugin.image={edit:function(){var o=m.plugin.getSelectedImage();m.plugin.imageDialog({imageUrl:o?o.attr("data-ke-src"):"http://",imageWidth:o?o.width():"",imageHeight:o?o.height():"",imageTitle:o?o.attr("title"):"",imageAlign:o?o.attr("align"):"",showRemote:false,showLocal:c,tabIndex:o?0:h,clickFn:function(t,s,u,r,q,p){m.exec("insertimage",t,s,u,r,q,p);setTimeout(function(){m.hideDialog().focus()},0)}})},"delete":function(){var o=m.plugin.getSelectedImage();if(o.parent().name=="a"){o=o.parent()}o.remove()}};m.clickToolbar(l,m.plugin.image.edit)});