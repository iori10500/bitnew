/* WebUploader 0.1.5 */
(function(i,d){var g={},b=function(m,l){var k,o,n;if(typeof m==="string"){return e(m)}else{k=[];for(o=m.length,n=0;n<o;n++){k.push(e(m[n]))}return l.apply(null,k)}},a=function(m,k,l){if(arguments.length===2){l=k;k=null}b(k||[],function(){j(m,l,arguments)})},j=function(m,l,k){var n={exports:l},o;if(typeof l==="function"){k.length||(k=[b,n.exports,n]);o=l.apply(null,k);o!==undefined&&(n.exports=o)}g[m]=n.exports},e=function(k){var l=g[k]||i[k];if(!l){throw new Error("`"+k+"` is undefined")}return l},c=function(n){var l,k,p,o,m,q;q=function(r){return r&&(r.charAt(0).toUpperCase()+r.substr(1))};for(l in g){k=n;if(!g.hasOwnProperty(l)){continue}p=l.split("/");m=q(p.pop());while((o=q(p.shift()))){k[o]=k[o]||{};k=k[o]}k[m]=g[l]}return n},f=function(k){i.__dollar=k;return c(d(i,a,b))},h;if(typeof module==="object"&&typeof module.exports==="object"){module.exports=f()}else{if(typeof define==="function"&&define.amd){define(["jquery"],f)}else{h=i.WebUploader;i.WebUploader=f();i.WebUploader.noConflict=function(){i.WebUploader=h}}}})(window,function(c,a,b){a("dollar-third",[],function(){var d=c.__dollar||c.jQuery||c.Zepto;if(!d){throw new Error("jQuery or Zepto not found!")}return d});a("dollar",["dollar-third"],function(d){return d});a("promise-third",["dollar"],function(d){return{Deferred:d.Deferred,when:d.when,isPromise:function(e){return e&&typeof e.then==="function"}}});a("promise",["promise-third"],function(d){return d});a("base",["dollar","promise"],function(d,i){var h=function(){},f=Function.call;function j(k){return function(){return f.apply(k,arguments)}}function e(l,k){return function(){return l.apply(k,arguments)}}function g(l){var k;if(Object.create){return Object.create(l)}else{k=function(){};k.prototype=l;return new k()}}return{version:"0.1.5",$:d,Deferred:i.Deferred,isPromise:i.isPromise,when:i.when,browser:(function(q){var o={},r=q.match(/WebKit\/([\d.]+)/),k=q.match(/Chrome\/([\d.]+)/)||q.match(/CriOS\/([\d.]+)/),m=q.match(/MSIE\s([\d\.]+)/)||q.match(/(?:trident)(?:.*rv:([\w.]+))?/i),l=q.match(/Firefox\/([\d.]+)/),p=q.match(/Safari\/([\d.]+)/),n=q.match(/OPR\/([\d.]+)/);r&&(o.webkit=parseFloat(r[1]));k&&(o.chrome=parseFloat(k[1]));m&&(o.ie=parseFloat(m[1]));l&&(o.firefox=parseFloat(l[1]));p&&(o.safari=parseFloat(p[1]));n&&(o.opera=parseFloat(n[1]));return o})(navigator.userAgent),os:(function(n){var m={},k=n.match(/(?:Android);?[\s\/]+([\d.]+)?/),l=n.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);k&&(m.android=parseFloat(k[1]));l&&(m.ios=parseFloat(l[1].replace(/_/g,".")));return m})(navigator.userAgent),inherits:function(n,l,m){var k;if(typeof l==="function"){k=l;l=null}else{if(l&&l.hasOwnProperty("constructor")){k=l.constructor}else{k=function(){return n.apply(this,arguments)}}}d.extend(true,k,n,m||{});k.__super__=n.prototype;k.prototype=g(n.prototype);l&&d.extend(true,k.prototype,l);return k},noop:h,bindFn:e,log:(function(){if(c.console){return e(console.log,console)}return h})(),nextTick:(function(){return function(k){setTimeout(k,1)}})(),slice:j([].slice),guid:(function(){var k=0;return function(n){var l=(+new Date()).toString(32),m=0;for(;m<5;m++){l+=Math.floor(Math.random()*65535).toString(32)}return(n||"wu_")+l+(k++).toString(32)}})(),formatSize:function(l,k,n){var m;n=n||["B","K","M","G","TB"];while((m=n.shift())&&l>1024){l=l/1024}return(m==="B"?l:l.toFixed(k||2))+m}}});a("mediator",["base"],function(e){var d=e.$,j=[].slice,i=/\s+/,h;function g(l,o,m,n){return d.grep(l,function(p){return p&&(!o||p.e===o)&&(!m||p.cb===m||p.cb._cb===m)&&(!n||p.ctx===n)})}function f(m,l,n){d.each((m||"").split(i),function(o,p){n(p,l)})}function k(m,l){var q=false,o=-1,p=m.length,n;while(++o<p){n=m[o];if(n.cb.apply(n.ctx2,l)===false){q=true;break}}return !q}h={on:function(o,l,m){var n=this,p;if(!l){return this}p=this._events||(this._events=[]);f(o,l,function(s,q){var r={e:s};r.cb=q;r.ctx=m;r.ctx2=m||n;r.id=p.length;p.push(r)});return this},once:function(o,l,m){var n=this;if(!l){return n}f(o,l,function(q,p){var r=function(){n.off(q,r);return p.apply(m||n,arguments)};r._cb=p;n.on(q,r,m)});return n},off:function(o,l,m){var n=this._events;if(!n){return this}if(!o&&!l&&!m){this._events=[];return this}f(o,l,function(q,p){d.each(g(n,q,p,m),function(){delete n[this.id]})});return this},trigger:function(o){var m,n,l;if(!this._events||!o){return this}m=j.call(arguments,1);n=g(this._events,o);l=g(this._events,"all");return k(n,m)&&k(l,arguments)}};return d.extend({installTo:function(l){return d.extend(l,h)}},h)});a("uploader",["base","mediator"],function(e,f){var d=e.$;function g(h){this.options=d.extend(true,{},g.options,h);this._init(this.options)}g.options={};f.installTo(g.prototype);d.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",cancelFile:"cancel-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",md5File:"md5-file",getDimension:"get-dimension",addButton:"add-btn",predictRuntimeType:"predict-runtime-type",refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(i,h){g.prototype[i]=function(){return this.request(h,arguments)}});d.extend(g.prototype,{state:"pending",_init:function(i){var h=this;h.request("init",i,function(){h.state="ready";h.trigger("ready")})},option:function(h,j){var i=this.options;if(arguments.length>1){if(d.isPlainObject(j)&&d.isPlainObject(i[h])){d.extend(i[h],j)}else{i[h]=j}}else{return h?i[h]:i}},getStats:function(){var h=this.request("get-stats");return h?{successNum:h.numOfSuccess,progressNum:h.numOfProgress,cancelNum:h.numOfCancel,invalidNum:h.numOfInvalid,uploadFailNum:h.numOfUploadFailed,queueNum:h.numOfQueue,interruptNum:h.numofInterrupt}:{}},trigger:function(k){var h=[].slice.call(arguments,1),j=this.options,i="on"+k.substring(0,1).toUpperCase()+k.substring(1);if(f.trigger.apply(this,arguments)===false||d.isFunction(j[i])&&j[i].apply(this,h)===false||d.isFunction(this[i])&&this[i].apply(this,h)===false||f.trigger.apply(f,[this,k].concat(h))===false){return false}return true},destroy:function(){this.request("destroy",arguments);this.off()},request:e.noop});e.create=g.create=function(h){return new g(h)};e.Uploader=g;return g});a("runtime/runtime",["base","mediator"],function(e,h){var d=e.$,f={},g=function(k){for(var j in k){if(k.hasOwnProperty(j)){return j}}return null};function i(j){this.options=d.extend({container:document.body},j);this.uid=e.guid("rt_")}d.extend(i.prototype,{getContainer:function(){var k=this.options,l,j;if(this._container){return this._container}l=d(k.container||document.body);j=d(document.createElement("div"));j.attr("id","rt_"+this.uid);j.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"});l.append(j);l.addClass("webuploader-container");this._container=j;this._parent=l;return j},init:e.noop,exec:e.noop,destroy:function(){this._container&&this._container.remove();this._parent&&this._parent.removeClass("webuploader-container");this.off()}});i.orders="html5,flash";i.addRuntime=function(k,j){f[k]=j};i.hasRuntime=function(j){return !!(j?f[j]:g(f))};i.create=function(j,k){var m,l;k=k||i.orders;d.each(k.split(/\s*,\s*/g),function(){if(f[this]){m=this;return false}});m=m||g(f);if(!m){throw new Error("Runtime Error")}l=new f[m](j);return l};h.installTo(i.prototype);return i});a("runtime/client",["base","mediator","runtime/runtime"],function(d,f,g){var e;e=(function(){var i={};return{add:function(j){i[j.uid]=j},get:function(k,l){var j;if(k){return i[k]}for(j in i){if(l&&i[j].__standalone){continue}return i[j]}return null},remove:function(j){delete i[j.uid]}}})();function h(i,l){var j=d.Deferred(),k;this.uid=d.guid("client_");this.runtimeReady=function(m){return j.done(m)};this.connectRuntime=function(n,m){if(k){throw new Error("already connected!")}j.done(m);if(typeof n==="string"&&e.get(n)){k=e.get(n)}k=k||e.get(null,l);if(!k){k=g.create(n,n.runtimeOrder);k.__promise=j.promise();k.once("ready",j.resolve);k.init();e.add(k);k.__client=1}else{d.$.extend(k.options,n);k.__promise.then(j.resolve);k.__client++}l&&(k.__standalone=l);return k};this.getRuntime=function(){return k};this.disconnectRuntime=function(){if(!k){return}k.__client--;if(k.__client<=0){e.remove(k);delete k.__promise;k.destroy()}k=null};this.exec=function(){if(!k){return}var m=d.slice(arguments);i&&m.unshift(i);return k.exec.apply(this,m)};this.getRuid=function(){return k&&k.uid};this.destroy=(function(m){return function(){m&&m.apply(this,arguments);this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()}})(this.destroy)}f.installTo(h.prototype);return h});a("lib/dnd",["base","mediator","runtime/client"],function(e,g,h){var d=e.$;function f(i){i=this.options=d.extend({},f.options,i);i.container=d(i.container);if(!i.container.length){return}h.call(this,"DragAndDrop")}f.options={accept:null,disableGlobalDnd:false};e.inherits(h,{constructor:f,init:function(){var i=this;i.connectRuntime(i.options,function(){i.exec("init");i.trigger("ready")})}});g.installTo(f.prototype);return f});a("widgets/widget",["base","uploader"],function(g,j){var d=g.$,f=j.prototype._init,e=j.prototype.destroy,h={},l=[];function i(n){if(!n){return false}var m=n.length,o=d.type(n);if(n.nodeType===1&&m){return true}return o==="array"||o!=="function"&&o!=="string"&&(m===0||typeof m==="number"&&m>0&&(m-1) in n)}function k(m){this.owner=m;this.options=m.options}d.extend(k.prototype,{init:g.noop,invoke:function(m,n){var o=this.responseMap;if(!o||!(m in o)||!(o[m] in this)||!d.isFunction(this[o[m]])){return h}return this[o[m]].apply(this,n)},request:function(){return this.owner.request.apply(this.owner,arguments)}});d.extend(j.prototype,{_init:function(){var n=this,o=n._widgets=[],m=n.options.disableWidgets||"";d.each(l,function(p,q){(!m||!~m.indexOf(q._name))&&o.push(new q(n))});return f.apply(n,arguments)},request:function(m,n,o){var q=0,x=this._widgets,s=x&&x.length,v=[],p=[],w,u,t,r;n=i(n)?n:[n];for(;q<s;q++){w=x[q];u=w.invoke(m,n);if(u!==h){if(g.isPromise(u)){p.push(u)}else{v.push(u)}}}if(o||p.length){t=g.when.apply(g,p);r=t.pipe?"pipe":"then";return t[r](function(){var z=g.Deferred(),y=arguments;if(y.length===1){y=y[0]}setTimeout(function(){z.resolve(y)},1);return z.promise()})[o?r:"done"](o||g.noop)}else{return v[0]}},destroy:function(){e.apply(this,arguments);this._widgets=null}});j.register=k.register=function(o,p){var n={init:"init",destroy:"destroy",name:"anonymous"},m;if(arguments.length===1){p=o;d.each(p,function(q){if(q[0]==="_"||q==="name"){q==="name"&&(n.name=p.name);return}n[q.replace(/[A-Z]/g,"-$&").toLowerCase()]=q})}else{n=d.extend(n,o)}p.responseMap=n;m=g.inherits(k,p);m._name=n.name;l.push(m);return m};j.unRegister=k.unRegister=function(n){if(!n||n==="anonymous"){return}for(var m=l.length;m--;){if(l[m]._name===n){l.splice(m,1)}}};return k});a("widgets/filednd",["base","uploader","lib/dnd","widgets/widget"],function(e,g,f){var d=e.$;g.options.dnd="";return g.register({name:"dnd",init:function(l){if(!l.dnd||this.request("predict-runtime-type")!=="html5"){return}var j=this,h=e.Deferred(),k=d.extend({},{disableGlobalDnd:l.disableGlobalDnd,container:l.dnd,accept:l.accept}),i;this.dnd=i=new f(k);i.once("ready",h.resolve);i.on("drop",function(m){j.request("add-file",[m])});i.on("accept",function(m){return j.owner.trigger("dndAccept",m)});i.init();return h.promise()},destroy:function(){this.dnd&&this.dnd.destroy()}})});a("lib/filepaste",["base","mediator","runtime/client"],function(e,g,h){var d=e.$;function f(i){i=this.options=d.extend({},i);i.container=d(i.container||document.body);h.call(this,"FilePaste")}e.inherits(h,{constructor:f,init:function(){var i=this;i.connectRuntime(i.options,function(){i.exec("init");i.trigger("ready")})}});g.installTo(f.prototype);return f});a("widgets/filepaste",["base","uploader","lib/filepaste","widgets/widget"],function(e,g,f){var d=e.$;return g.register({name:"paste",init:function(k){if(!k.paste||this.request("predict-runtime-type")!=="html5"){return}var i=this,h=e.Deferred(),j=d.extend({},{container:k.paste,accept:k.accept}),l;this.paste=l=new f(j);l.once("ready",h.resolve);l.on("paste",function(m){i.owner.request("add-file",[m])});l.init();return h.promise()},destroy:function(){this.paste&&this.paste.destroy()}})});a("lib/blob",["base","runtime/client"],function(d,f){function e(h,i){var g=this;g.source=i;g.ruid=h;this.size=i.size||0;if(!i.type&&this.ext&&~"jpg,jpeg,png,gif,bmp".indexOf(this.ext)){this.type="image/"+(this.ext==="jpg"?"jpeg":this.ext)}else{this.type=i.type||"application/octet-stream"}f.call(g,"Blob");this.uid=i.uid||this.uid;if(h){g.connectRuntime(h)}}d.inherits(f,{constructor:e,slice:function(h,g){return this.exec("slice",h,g)},getSource:function(){return this.source}});return e});a("lib/file",["base","lib/blob"],function(d,e){var h=1,g=/\.([^.]+)$/;function f(k,j){var i;this.name=j.name||("untitled"+h++);i=g.exec(j.name)?RegExp.$1.toLowerCase():"";if(!i&&j.type){i=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(j.type)?RegExp.$1.toLowerCase():"";this.name+="."+i}this.ext=i;this.lastModifiedDate=j.lastModifiedDate||(new Date()).toLocaleString();e.apply(this,arguments)}return d.inherits(e,f)});a("lib/filepicker",["base","runtime/client","lib/file"],function(e,h,f){var d=e.$;function g(i){i=this.options=d.extend({},g.options,i);i.container=d(i.id);if(!i.container.length){throw new Error("按钮指定错误")}i.innerHTML=i.innerHTML||i.label||i.container.html()||"";i.button=d(i.button||document.createElement("div"));i.button.html(i.innerHTML);i.container.html(i.button);h.call(this,"FilePicker",true)}g.options={button:null,container:null,label:null,innerHTML:null,multiple:true,accept:null,name:"file"};e.inherits(h,{constructor:g,init:function(){var j=this,k=j.options,i=k.button;i.addClass("webuploader-pick");j.on("all",function(m){var l;switch(m){case"mouseenter":i.addClass("webuploader-pick-hover");break;case"mouseleave":i.removeClass("webuploader-pick-hover");break;case"change":l=j.exec("getFiles");j.trigger("select",d.map(l,function(n){n=new f(j.getRuid(),n);n._refer=k.container;return n}),k.container);break}});j.connectRuntime(k,function(){j.refresh();j.exec("init",k);j.trigger("ready")});this._resizeHandler=e.bindFn(this.refresh,this);d(c).on("resize",this._resizeHandler)},refresh:function(){var l=this.getRuntime().getContainer(),i=this.options.button,m=i.outerWidth?i.outerWidth():i.width(),j=i.outerHeight?i.outerHeight():i.height(),k=i.offset();m&&j&&l.css({bottom:"auto",right:"auto",width:m+"px",height:j+"px"}).offset(k)},enable:function(){var i=this.options.button;i.removeClass("webuploader-pick-disable");this.refresh()},disable:function(){var i=this.options.button;this.getRuntime().getContainer().css({top:"-99999px"});i.addClass("webuploader-pick-disable")},destroy:function(){var i=this.options.button;d(c).off("resize",this._resizeHandler);i.removeClass("webuploader-pick-disable webuploader-pick-hover webuploader-pick")}});return g});a("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(e,g,f){var d=e.$;d.extend(g.options,{pick:null,accept:null});return g.register({name:"picker",init:function(h){this.pickers=[];return h.pick&&this.addBtn(h.pick)},refresh:function(){d.each(this.pickers,function(){this.refresh()})},addBtn:function(k){var i=this,j=i.options,h=j.accept,l=[];if(!k){return}d.isPlainObject(k)||(k={id:k});d(k.id).each(function(){var n,o,m;m=e.Deferred();n=d.extend({},k,{accept:d.isPlainObject(h)?[h]:h,swf:j.swf,runtimeOrder:j.runtimeOrder,id:this});o=new f(n);o.once("ready",m.resolve);o.on("select",function(p){i.owner.request("add-file",[p])});o.init();i.pickers.push(o);l.push(m.promise())});return e.when.apply(e,l)},disable:function(){d.each(this.pickers,function(){this.disable()})},enable:function(){d.each(this.pickers,function(){this.enable()})},destroy:function(){d.each(this.pickers,function(){this.destroy()});this.pickers=null}})});a("lib/image",["base","runtime/client","lib/blob"],function(e,h,f){var d=e.$;function g(i){this.options=d.extend({},g.options,i);h.call(this,"Image");this.on("load",function(){this._info=this.exec("info");this._meta=this.exec("meta")})}g.options={quality:90,crop:false,preserveHeaders:false,allowMagnify:false};e.inherits(h,{constructor:g,info:function(i){if(i){this._info=i;return this}return this._info},meta:function(i){if(i){this._meta=i;return this}return this._meta},loadFromBlob:function(i){var j=this,k=i.getRuid();this.connectRuntime(k,function(){j.exec("init",j.options);j.exec("loadFromBlob",i)})},resize:function(){var i=e.slice(arguments);return this.exec.apply(this,["resize"].concat(i))},crop:function(){var i=e.slice(arguments);return this.exec.apply(this,["crop"].concat(i))},getAsDataUrl:function(i){return this.exec("getAsDataUrl",i)},getAsBlob:function(j){var i=this.exec("getAsBlob",j);return new f(this.getRuid(),i)}});return g});a("widgets/image",["base","uploader","lib/image","widgets/widget"],function(e,h,f){var d=e.$,g;g=(function(i){var j=0,l=[],k=function(){var m;while(l.length&&j<i){m=l.shift();j+=m[0];m[1]()}};return function(n,o,m){l.push([o,m]);n.once("destroy",function(){j-=o;setTimeout(k,1)});setTimeout(k,1)}})(5*1024*1024);d.extend(h.options,{thumb:{width:110,height:110,quality:70,allowMagnify:true,crop:true,preserveHeaders:false,type:"image/jpeg"},compress:{width:1600,height:1600,quality:90,allowMagnify:false,crop:false,preserveHeaders:true}});return h.register({name:"image",makeThumb:function(j,i,n,k){var m,l;j=this.request("get-file",j);if(!j.type.match(/^image/)){i(true);return}m=d.extend({},this.options.thumb);if(d.isPlainObject(n)){m=d.extend(m,n);n=null}n=n||m.width;k=k||m.height;l=new f(m);l.once("load",function(){j._info=j._info||l.info();j._meta=j._meta||l.meta();if(n<=1&&n>0){n=j._info.width*n}if(k<=1&&k>0){k=j._info.height*k}l.resize(n,k)});l.once("complete",function(){i(false,l.getAsDataUrl(m.type));l.destroy()});l.once("error",function(o){i(o||true);l.destroy()});g(l,j.source.size,function(){j._info&&l.info(j._info);j._meta&&l.meta(j._meta);l.loadFromBlob(j.source)})},beforeSendFile:function(k){var n=this.options.compress||this.options.resize,i=n&&n.compressSize||0,m=n&&n.noCompressIfLarger||false,l,j;k=this.request("get-file",k);if(!n||!~"image/jpeg,image/jpg".indexOf(k.type)||k.size<i||k._compressed){return}n=d.extend({},n);j=e.Deferred();l=new f(n);j.always(function(){l.destroy();l=null});l.once("error",j.reject);l.once("load",function(){var p=n.width,o=n.height;k._info=k._info||l.info();k._meta=k._meta||l.meta();if(p<=1&&p>0){p=k._info.width*p}if(o<=1&&o>0){o=k._info.height*o}l.resize(p,o)});l.once("complete",function(){var o,q;try{o=l.getAsBlob(n.type);q=k.size;if(!m||o.size<q){k.source=o;k.size=o.size;k.trigger("resize",o.size,q)}k._compressed=true;j.resolve()}catch(p){j.resolve()}});k._info&&l.info(k._info);k._meta&&l.meta(k._meta);l.loadFromBlob(k.source);return j.promise()}})});a("file",["base","mediator"],function(e,i){var d=e.$,g="WU_FILE_",h=0,j=/\.([^.]+)$/,k={};function f(){return g+h++}function l(m){this.name=m.name||"Untitled";this.size=m.size||0;this.type=m.type||"application/octet-stream";this.lastModifiedDate=m.lastModifiedDate||(new Date()*1);this.id=f();this.ext=j.exec(this.name)?RegExp.$1:"";this.statusText="";k[this.id]=l.Status.INITED;this.source=m;this.loaded=0;this.on("error",function(n){this.setStatus(l.Status.ERROR,n)})}d.extend(l.prototype,{setStatus:function(n,o){var m=k[this.id];typeof o!=="undefined"&&(this.statusText=o);if(n!==m){k[this.id]=n;this.trigger("statuschange",n,m)}},getStatus:function(){return k[this.id]},getSource:function(){return this.source},destroy:function(){this.off();delete k[this.id]}});i.installTo(l.prototype);l.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"};return l});a("queue",["base","mediator","file"],function(e,f,i){var d=e.$,h=i.Status;function g(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0,numofDeleted:0,numofInterrupt:0};this._queue=[];this._map={}}d.extend(g.prototype,{append:function(j){this._queue.push(j);this._fileAdded(j);return this},prepend:function(j){this._queue.unshift(j);this._fileAdded(j);return this},getFile:function(j){if(typeof j!=="string"){return j}return this._map[j]},fetch:function(m){var l=this._queue.length,k,j;m=m||h.QUEUED;for(k=0;k<l;k++){j=this._queue[k];if(m===j.getStatus()){return j}}return null},sort:function(j){if(typeof j==="function"){this._queue.sort(j)}},getFiles:function(){var n=[].slice.call(arguments,0),m=[],k=0,l=this._queue.length,j;for(;k<l;k++){j=this._queue[k];if(n.length&&!~d.inArray(j.getStatus(),n)){continue}m.push(j)}return m},removeFile:function(k){var l=this,j=this._map[k.id];if(j){delete this._map[k.id];k.destroy();this.stats.numofDeleted++}},_fileAdded:function(k){var l=this,j=this._map[k.id];if(!j){this._map[k.id]=k;k.on("statuschange",function(m,n){l._onFileStatusChange(m,n)})}},_onFileStatusChange:function(j,k){var l=this.stats;switch(k){case h.PROGRESS:l.numOfProgress--;break;case h.QUEUED:l.numOfQueue--;break;case h.ERROR:l.numOfUploadFailed--;break;case h.INVALID:l.numOfInvalid--;break;case h.INTERRUPT:l.numofInterrupt--;break}switch(j){case h.QUEUED:l.numOfQueue++;break;case h.PROGRESS:l.numOfProgress++;break;case h.ERROR:l.numOfUploadFailed++;break;case h.COMPLETE:l.numOfSuccess++;break;case h.CANCELLED:l.numOfCancel++;break;case h.INVALID:l.numOfInvalid++;break;case h.INTERRUPT:l.numofInterrupt++;break}}});f.installTo(g.prototype);return g});a("widgets/queue",["base","uploader","queue","file","lib/file","runtime/client","widgets/widget"],function(e,k,g,l,f,i){var d=e.$,h=/\.\w+$/,j=l.Status;return k.register({name:"queue",init:function(t){var s=this,o,r,p,q,n,m,u;if(d.isPlainObject(t.accept)){t.accept=[t.accept]}if(t.accept){n=[];for(p=0,r=t.accept.length;p<r;p++){q=t.accept[p].extensions;q&&n.push(q)}if(n.length){m="\\."+n.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$"}s.accept=new RegExp(m,"i")}s.queue=new g();s.stats=s.queue.stats;if(this.request("predict-runtime-type")!=="html5"){return}o=e.Deferred();this.placeholder=u=new i("Placeholder");u.connectRuntime({runtimeOrder:"html5"},function(){s._ruid=u.getRuid();o.resolve()});return o.promise()},_wrapFile:function(m){if(!(m instanceof l)){if(!(m instanceof f)){if(!this._ruid){throw new Error("Can't add external files.")}m=new f(this._ruid,m)}m=new l(m)}return m},acceptFile:function(m){var n=!m||!m.size||this.accept&&h.exec(m.name)&&!this.accept.test(m.name);return !n},_addFile:function(m){var n=this;m=n._wrapFile(m);if(!n.owner.trigger("beforeFileQueued",m)){return}if(!n.acceptFile(m)){n.owner.trigger("error","Q_TYPE_DENIED",m);return}n.queue.append(m);n.owner.trigger("fileQueued",m);return m},getFile:function(m){return this.queue.getFile(m)},addFile:function(m){var n=this;if(!m.length){m=[m]}m=d.map(m,function(o){return n._addFile(o)});n.owner.trigger("filesQueued",m);if(n.options.auto){setTimeout(function(){n.request("start-upload")},20)}},getStats:function(){return this.stats},removeFile:function(m,o){var n=this;m=m.id?m:n.queue.getFile(m);this.request("cancel-file",m);if(o){this.queue.removeFile(m)}},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(m,r){var q=this,n,o,p;if(m){m=m.id?m:q.queue.getFile(m);m.setStatus(j.QUEUED);r||q.request("start-upload");return}n=q.queue.getFiles(j.ERROR);o=0;p=n.length;for(;o<p;o++){m=n[o];m.setStatus(j.QUEUED)}q.request("start-upload")},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},reset:function(){this.owner.trigger("reset");this.queue=new g();this.stats=this.queue.stats},destroy:function(){this.reset();this.placeholder&&this.placeholder.destroy()}})});a("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(e,d){e.support=function(){return d.hasRuntime.apply(d,arguments)};return e.register({name:"runtime",init:function(){if(!this.predictRuntimeType()){throw Error("Runtime Error")}},predictRuntimeType:function(){var h=this.options.runtimeOrder||d.orders,j=this.type,f,g;if(!j){h=h.split(/\s*,\s*/g);for(f=0,g=h.length;f<g;f++){if(d.hasRuntime(h[f])){this.type=j=h[f];break}}}return j}})});a("lib/transport",["base","runtime/client","mediator"],function(e,g,f){var d=e.$;function h(j){var i=this;j=i.options=d.extend(true,{},h.options,j||{});g.call(this,"Transport");this._blob=null;this._formData=j.formData||{};this._headers=j.headers||{};this.on("progress",this._timeout);this.on("load error",function(){i.trigger("progress",1);clearTimeout(i._timer)})}h.options={server:"",method:"POST",withCredentials:false,fileVal:"file",timeout:2*60*1000,formData:{},headers:{},sendAsBinary:false};d.extend(h.prototype,{appendBlob:function(k,i,j){var l=this,m=l.options;if(l.getRuid()){l.disconnectRuntime()}l.connectRuntime(i.ruid,function(){l.exec("init")});l._blob=i;m.fileVal=k||m.fileVal;m.filename=j||m.filename},append:function(i,j){if(typeof i==="object"){d.extend(this._formData,i)}else{this._formData[i]=j}},setRequestHeader:function(i,j){if(typeof i==="object"){d.extend(this._headers,i)}else{this._headers[i]=j}},send:function(i){this.exec("send",i);this._timeout()},abort:function(){clearTimeout(this._timer);return this.exec("abort")},destroy:function(){this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var j=this,i=j.options.timeout;if(!i){return}clearTimeout(j._timer);j._timer=setTimeout(function(){j.abort();j.trigger("error","timeout")},i)}});f.installTo(h.prototype);return h});a("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(e,j,k,i){var d=e.$,g=e.isPromise,h=k.Status;d.extend(j.options,{prepareNextFile:false,chunked:false,chunkSize:5*1024*1024,chunkRetry:2,threads:3,formData:{}});function f(p,o){var s=[],m=p.source,u=m.size,n=o?Math.ceil(u/o):1,t=0,q=0,r,l;l={file:p,has:function(){return !!s.length},shift:function(){return s.shift()},unshift:function(v){s.unshift(v)}};while(q<n){r=Math.min(o,u-t);s.push({file:p,start:t,end:o?(t+r):u,total:u,chunks:n,chunk:q++,cuted:l});t+=r}p.blocks=s.concat();p.remaning=s.length;return l}j.register({name:"upload",init:function(){var m=this.owner,l=this;this.runing=false;this.progress=false;m.on("startUpload",function(){l.progress=true}).on("uploadFinished",function(){l.progress=false});this.pool=[];this.stack=[];this.pending=[];this.remaning=0;this.__tick=e.bindFn(this._tick,this);m.on("uploadComplete",function(n){n.blocks&&d.each(n.blocks,function(o,p){p.transport&&(p.transport.abort(),p.transport.destroy());delete p.transport});delete n.blocks;delete n.remaning})},reset:function(){this.request("stop-upload",true);this.runing=false;this.pool=[];this.stack=[];this.pending=[];this.remaning=0;this._trigged=false;this._promise=null},startUpload:function(l){var n=this;d.each(n.request("get-files",h.INVALID),function(){n.request("remove-file",this)});if(l){l=l.id?l:n.request("get-file",l);if(l.getStatus()===h.INTERRUPT){d.each(n.pool,function(o,p){if(p.file!==l){return}p.transport&&p.transport.send()});l.setStatus(h.QUEUED)}else{if(l.getStatus()===h.PROGRESS){return}else{l.setStatus(h.QUEUED)}}}else{d.each(n.request("get-files",[h.INITED]),function(){this.setStatus(h.QUEUED)})}if(n.runing){return}n.runing=true;var m=[];d.each(n.pool,function(o,q){var p=q.file;if(p.getStatus()===h.INTERRUPT){m.push(p);n._trigged=false;q.transport&&q.transport.send()}});var l;while((l=m.shift())){l.setStatus(h.PROGRESS)}l||d.each(n.request("get-files",h.INTERRUPT),function(){this.setStatus(h.PROGRESS)});n._trigged=false;e.nextTick(n.__tick);n.owner.trigger("startUpload")},stopUpload:function(l,m){var n=this;if(l===true){m=l;l=null}if(n.runing===false){return}if(l){l=l.id?l:n.request("get-file",l);if(l.getStatus()!==h.PROGRESS&&l.getStatus()!==h.QUEUED){return}l.setStatus(h.INTERRUPT);d.each(n.pool,function(o,p){if(p.file!==l){return}p.transport&&p.transport.abort();n._putback(p);n._popBlock(p)});return e.nextTick(n.__tick)}n.runing=false;if(this._promise&&this._promise.file){this._promise.file.setStatus(h.INTERRUPT)}m&&d.each(n.pool,function(o,p){p.transport&&p.transport.abort();p.file.setStatus(h.INTERRUPT)});n.owner.trigger("stopUpload")},cancelFile:function(l){l=l.id?l:this.request("get-file",l);l.blocks&&d.each(l.blocks,function(m,o){var n=o.transport;if(n){n.abort();n.destroy();delete o.transport}});l.setStatus(h.CANCELLED);this.owner.trigger("fileDequeued",l)},isInProgress:function(){return !!this.progress},_getStats:function(){return this.request("get-stats")},skipFile:function(l,m){l=l.id?l:this.request("get-file",l);l.setStatus(m||h.COMPLETE);l.skipped=true;l.blocks&&d.each(l.blocks,function(n,p){var o=p.transport;if(o){o.abort();o.destroy();delete p.transport}});this.owner.trigger("uploadSkip",l)},_tick:function(){var m=this,n=m.options,l,o;if(m._promise){return m._promise.always(m.__tick)}if(m.pool.length<n.threads&&(o=m._nextBlock())){m._trigged=false;l=function(p){m._promise=null;p&&p.file&&m._startSend(p);e.nextTick(m.__tick)};m._promise=g(o)?o.always(l):l(o)}else{if(!m.remaning&&!m._getStats().numOfQueue&&!m._getStats().numofInterrupt){m.runing=false;m._trigged||e.nextTick(function(){m.owner.trigger("uploadFinished")});m._trigged=true}}},_putback:function(l){var m;l.cuted.unshift(l);m=this.stack.indexOf(l.cuted);if(!~m){this.stack.unshift(l.cuted)}},_getStack:function(){var m=0,l;while((l=this.stack[m++])){if(l.has()&&l.file.getStatus()===h.PROGRESS){return l}else{if(!l.has()||l.file.getStatus()!==h.PROGRESS&&l.file.getStatus()!==h.INTERRUPT){this.stack.splice(--m,1)}}}return null},_nextBlock:function(){var n=this,p=n.options,l,o,m,q;if((l=this._getStack())){if(p.prepareNextFile&&!n.pending.length){n._prepareNextFile()}return l.shift()}else{if(n.runing){if(!n.pending.length&&n._getStats().numOfQueue){n._prepareNextFile()}o=n.pending.shift();m=function(r){if(!r){return null}l=f(r,p.chunked?p.chunkSize:0);n.stack.push(l);return l.shift()};if(g(o)){q=o.file;o=o[o.pipe?"pipe":"then"](m);o.file=q;return o}return m(o)}}},_prepareNextFile:function(){var m=this,l=m.request("fetch-file"),n=m.pending,o;if(l){o=m.request("before-send-file",l,function(){if(l.getStatus()===h.PROGRESS||l.getStatus()===h.INTERRUPT){return l}return m._finishFile(l)});m.owner.trigger("uploadStart",l);l.setStatus(h.PROGRESS);o.file=l;o.done(function(){var p=d.inArray(o,n);~p&&n.splice(p,1,l)});o.fail(function(p){l.setStatus(h.ERROR,p);m.owner.trigger("uploadError",l,p);m.owner.trigger("uploadComplete",l)});n.push(o)}},_popBlock:function(l){var m=d.inArray(l,this.pool);this.pool.splice(m,1);l.file.remaning--;this.remaning--},_startSend:function(l){var n=this,m=l.file,o;if(m.getStatus()!==h.PROGRESS){if(m.getStatus()===h.INTERRUPT){n._putback(l)}return}n.pool.push(l);n.remaning++;l.blob=l.chunks===1?m.source:m.source.slice(l.start,l.end);o=n.request("before-send",l,function(){if(m.getStatus()===h.PROGRESS){n._doSend(l)}else{n._popBlock(l);e.nextTick(n.__tick)}});o.fail(function(){if(m.remaning===1){n._finishFile(m).always(function(){l.percentage=1;n._popBlock(l);n.owner.trigger("uploadComplete",m);e.nextTick(n.__tick)})}else{l.percentage=1;n.updateFileProgress(m);n._popBlock(l);e.nextTick(n.__tick)}})},_doSend:function(l){var p=this,r=p.owner,q=p.options,n=l.file,u=new i(q),m=d.extend({},q.formData),o=d.extend({},q.headers),s,t;l.transport=u;u.on("destroy",function(){delete l.transport;p._popBlock(l);e.nextTick(p.__tick)});u.on("progress",function(v){l.percentage=v;p.updateFileProgress(n)});s=function(w){var v;t=u.getResponseAsJson()||{};t._raw=u.getResponse();v=function(x){w=x};if(!r.trigger("uploadAccept",l,t,v)){w=w||"server"}return w};u.on("error",function(w,v){l.retried=l.retried||0;if(l.chunks>1&&~"http,abort".indexOf(w)&&l.retried<q.chunkRetry){l.retried++;u.send()}else{if(!v&&w==="server"){w=s(w)}n.setStatus(h.ERROR,w);r.trigger("uploadError",n,w);r.trigger("uploadComplete",n)}});u.on("load",function(){var v;if((v=s())){u.trigger("error",v,true);return}if(n.remaning===1){p._finishFile(n,t)}else{u.destroy()}});m=d.extend(m,{id:n.id,name:n.name,type:n.type,lastModifiedDate:n.lastModifiedDate,size:n.size});l.chunks>1&&d.extend(m,{chunks:l.chunks,chunk:l.chunk});r.trigger("uploadBeforeSend",l,m,o);u.appendBlob(q.fileVal,l.blob,n.name);u.append(m);u.setRequestHeader(o);u.send()},_finishFile:function(l,o,m){var n=this.owner;return n.request("after-send-file",arguments,function(){l.setStatus(h.COMPLETE);n.trigger("uploadSuccess",l,o,m)}).fail(function(p){if(l.getStatus()===h.PROGRESS){l.setStatus(h.ERROR,p)}n.trigger("uploadError",l,p)}).always(function(){n.trigger("uploadComplete",l)})},updateFileProgress:function(l){var m=0,n=0;if(!l.blocks){return}d.each(l.blocks,function(o,p){n+=(p.percentage||0)*(p.end-p.start)});m=n/l.size;this.owner.trigger("uploadProgress",l,m||0)}})});a("widgets/validator",["base","uploader","file","widgets/widget"],function(f,g,i){var d=f.$,h={},e;e={addValidator:function(k,j){h[k]=j},removeValidator:function(j){delete h[j]}};g.register({name:"validator",init:function(){var j=this;f.nextTick(function(){d.each(h,function(){this.call(j.owner)})})}});e.addValidator("fileNumLimit",function(){var n=this,m=n.options,j=0,l=parseInt(m.fileNumLimit,10),k=true;if(!l){return}n.on("beforeFileQueued",function(o){if(j>=l&&k){k=false;this.trigger("error","Q_EXCEED_NUM_LIMIT",l,o);setTimeout(function(){k=true},1)}return j>=l?false:true});n.on("fileQueued",function(){j++});n.on("fileDequeued",function(){j--});n.on("reset",function(){j=0})});e.addValidator("fileSizeLimit",function(){var n=this,m=n.options,j=0,l=parseInt(m.fileSizeLimit,10),k=true;if(!l){return}n.on("beforeFileQueued",function(o){var p=j+o.size>l;if(p&&k){k=false;this.trigger("error","Q_EXCEED_SIZE_LIMIT",l,o);setTimeout(function(){k=true},1)}return p?false:true});n.on("fileQueued",function(o){j+=o.size});n.on("fileDequeued",function(o){j-=o.size});n.on("reset",function(){j=0})});e.addValidator("fileSingleSizeLimit",function(){var l=this,k=l.options,j=k.fileSingleSizeLimit;if(!j){return}l.on("beforeFileQueued",function(m){if(m.size>j){m.setStatus(i.Status.INVALID,"exceed_size");this.trigger("error","F_EXCEED_SIZE",j,m);return false}})});e.addValidator("duplicate",function(){var m=this,l=m.options,k={};if(l.duplicate){return}function j(r){var o=0,p=0,q=r.length,n;for(;p<q;p++){n=r.charCodeAt(p);o=n+(o<<6)+(o<<16)-o}return o}m.on("beforeFileQueued",function(n){var o=n.__hash||(n.__hash=j(n.name+n.size+n.lastModifiedDate));if(k[o]){this.trigger("error","F_DUPLICATE",n);return false}});m.on("fileQueued",function(n){var o=n.__hash;o&&(k[o]=true)});m.on("fileDequeued",function(n){var o=n.__hash;o&&(delete k[o])});m.on("reset",function(){k={}})});return e});a("lib/md5",["runtime/client","mediator"],function(f,e){function d(){f.call(this,"Md5")}e.installTo(d.prototype);d.prototype.loadFromBlob=function(g){var h=this;if(h.getRuid()){h.disconnectRuntime()}h.connectRuntime(g.ruid,function(){h.exec("init");h.exec("loadFromBlob",g)})};d.prototype.getResult=function(){return this.exec("getResult")};return d});a("widgets/md5",["base","uploader","lib/md5","lib/blob","widgets/widget"],function(d,g,f,e){return g.register({name:"md5",md5File:function(k,m,j){var l=new f(),i=d.Deferred(),h=(k instanceof e)?k:this.request("get-file",k).source;l.on("progress load",function(n){n=n||{};i.notify(n.total?n.loaded/n.total:1)});l.on("complete",function(){i.resolve(l.getResult())});l.on("error",function(n){i.reject(n)});if(arguments.length>1){m=m||0;j=j||0;m<0&&(m=h.size+m);j<0&&(j=h.size+j);j=Math.min(j,h.size);h=h.slice(m,j)}l.loadFromBlob(h);return i.promise()}})});a("runtime/compbase",[],function(){function d(e,f){this.owner=e;this.options=e.options;this.getRuntime=function(){return f};this.getRuid=function(){return f.uid};this.trigger=function(){return e.trigger.apply(e,arguments)}}return d});a("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(d,h,e){var i="html5",f={};function g(){var l={},k=this,j=this.destroy;h.apply(k,arguments);k.type=i;k.exec=function(o,p){var n=this,r=n.uid,m=d.slice(arguments,2),q;if(f[o]){q=l[r]=l[r]||new f[o](n,k);if(q[p]){return q[p].apply(q,m)}}};k.destroy=function(){return j&&j.apply(this,arguments)}}d.inherits(h,{constructor:g,init:function(){var j=this;setTimeout(function(){j.trigger("ready")},1)}});g.register=function(l,j){var k=f[l]=d.inherits(e,j);return k};if(c.Blob&&c.FileReader&&c.DataView){h.addRuntime(i,g)}return g});a("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(e,d){return e.register("Blob",{slice:function(i,g){var f=this.owner.source,h=f.slice||f.webkitSlice||f.mozSlice;f=h.call(f,i,g);return new d(this.getRuid(),f)}})});a("runtime/html5/dnd",["base","runtime/html5/runtime","lib/file"],function(e,g,f){var d=e.$,h="webuploader-dnd-";return g.register("DragAndDrop",{init:function(){var i=this.elem=this.options.container;this.dragEnterHandler=e.bindFn(this._dragEnterHandler,this);this.dragOverHandler=e.bindFn(this._dragOverHandler,this);this.dragLeaveHandler=e.bindFn(this._dragLeaveHandler,this);this.dropHandler=e.bindFn(this._dropHandler,this);this.dndOver=false;i.on("dragenter",this.dragEnterHandler);i.on("dragover",this.dragOverHandler);i.on("dragleave",this.dragLeaveHandler);i.on("drop",this.dropHandler);if(this.options.disableGlobalDnd){d(document).on("dragover",this.dragOverHandler);d(document).on("drop",this.dropHandler)}},_dragEnterHandler:function(j){var l=this,i=l._denied||false,k;j=j.originalEvent||j;if(!l.dndOver){l.dndOver=true;k=j.dataTransfer.items;if(k&&k.length){l._denied=i=!l.trigger("accept",k)}l.elem.addClass(h+"over");l.elem[i?"addClass":"removeClass"](h+"denied")}j.dataTransfer.dropEffect=i?"none":"copy";return false},_dragOverHandler:function(i){var j=this.elem.parent().get(0);if(j&&!d.contains(j,i.currentTarget)){return false}clearTimeout(this._leaveTimer);this._dragEnterHandler.call(this,i);return false},_dragLeaveHandler:function(){var j=this,i;i=function(){j.dndOver=false;j.elem.removeClass(h+"over "+h+"denied")};clearTimeout(j._leaveTimer);j._leaveTimer=setTimeout(i,100);return false},_dropHandler:function(k){var m=this,o=m.getRuid(),n=m.elem.parent().get(0),j,i;if(n&&!d.contains(n,k.currentTarget)){return false}k=k.originalEvent||k;j=k.dataTransfer;try{i=j.getData("text/html")}catch(l){}if(i){return}m._getTansferFiles(j,function(p){m.trigger("drop",d.map(p,function(q){return new f(o,q)}))});m.dndOver=false;m.elem.removeClass(h+"over");return false},_getTansferFiles:function(l,j){var t=[],s=[],q,n,m,p,o,r,k;q=l.items;n=l.files;k=!!(q&&q[0].webkitGetAsEntry);for(o=0,r=n.length;o<r;o++){m=n[o];p=q&&q[o];if(k&&p.webkitGetAsEntry().isDirectory){s.push(this._traverseDirectoryTree(p.webkitGetAsEntry(),t))}else{t.push(m)}}e.when.apply(e,s).done(function(){if(!t.length){return}j(t)})},_traverseDirectoryTree:function(j,l){var i=e.Deferred(),k=this;if(j.isFile){j.file(function(m){l.push(m);i.resolve()})}else{if(j.isDirectory){j.createReader().readEntries(function(n){var p=n.length,q=[],m=[],o;for(o=0;o<p;o++){q.push(k._traverseDirectoryTree(n[o],m))}e.when.apply(e,q).then(function(){l.push.apply(l,m);i.resolve()},i.reject)})}}return i.promise()},destroy:function(){var i=this.elem;if(!i){return}i.off("dragenter",this.dragEnterHandler);i.off("dragover",this.dragOverHandler);i.off("dragleave",this.dragLeaveHandler);i.off("drop",this.dropHandler);if(this.options.disableGlobalDnd){d(document).off("dragover",this.dragOverHandler);d(document).off("drop",this.dropHandler)}}})});a("runtime/html5/filepaste",["base","runtime/html5/runtime","lib/file"],function(d,f,e){return f.register("FilePaste",{init:function(){var n=this.options,j=this.elem=n.container,g=".*",h,k,m,l;if(n.accept){h=[];for(k=0,m=n.accept.length;k<m;k++){l=n.accept[k].mimeTypes;l&&h.push(l)}if(h.length){g=h.join(",");g=g.replace(/,/g,"|").replace(/\*/g,".*")}}this.accept=g=new RegExp(g,"i");this.hander=d.bindFn(this._pasteHander,this);j.on("paste",this.hander)},_pasteHander:function(j){var g=[],o=this.getRuid(),m,l,h,k,n;j=j.originalEvent||j;m=j.clipboardData.items;for(k=0,n=m.length;k<n;k++){l=m[k];if(l.kind!=="file"||!(h=l.getAsFile())){continue}g.push(new e(o,h))}if(g.length){j.preventDefault();j.stopPropagation();this.trigger("paste",g)}},destroy:function(){this.elem.off("paste",this.hander)}})});a("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(e,f){var d=e.$;return f.register("FilePicker",{init:function(){var h=this.getRuntime().getContainer(),n=this,q=n.owner,p=n.options,l=this.label=d(document.createElement("label")),k=this.input=d(document.createElement("input")),g,j,m,o;k.attr("type","file");k.attr("name",p.name);k.addClass("webuploader-element-invisible");l.on("click",function(){k.trigger("click")});l.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"});if(p.multiple){k.attr("multiple","multiple")}if(p.accept&&p.accept.length>0){g=[];for(j=0,m=p.accept.length;j<m;j++){g.push(p.accept[j].mimeTypes)}k.attr("accept",g.join(","))}h.append(k);h.append(l);o=function(i){q.trigger(i.type)};k.on("change",function(r){var s=arguments.callee,i;n.files=r.target.files;i=this.cloneNode(true);i.value=null;this.parentNode.replaceChild(i,this);k.off();k=d(i).on("change",s).on("mouseenter mouseleave",o);q.trigger("change")});l.on("mouseenter mouseleave",o)},getFiles:function(){return this.files},destroy:function(){this.input.off();this.label.off()}})});a("runtime/html5/util",["base"],function(d){var g=c.createObjectURL&&c||c.URL&&URL.revokeObjectURL&&URL||c.webkitURL,e=d.noop,f=e;if(g){e=function(){return g.createObjectURL.apply(g,arguments)};f=function(){return g.revokeObjectURL.apply(g,arguments)}}return{createObjectURL:e,revokeObjectURL:f,dataURL2Blob:function(k){var j,m,h,l,n,o;o=k.split(",");if(~o[0].indexOf("base64")){j=atob(o[1])}else{j=decodeURIComponent(o[1])}h=new ArrayBuffer(j.length);m=new Uint8Array(h);for(l=0;l<j.length;l++){m[l]=j.charCodeAt(l)}n=o[0].split(":")[1].split(";")[0];return this.arrayBufferToBlob(h,n)},dataURL2ArrayBuffer:function(j){var h,l,k,m;m=j.split(",");if(~m[0].indexOf("base64")){h=atob(m[1])}else{h=decodeURIComponent(m[1])}l=new Uint8Array(h.length);for(k=0;k<h.length;k++){l[k]=h.charCodeAt(k)}return l.buffer},arrayBufferToBlob:function(i,k){var j=c.BlobBuilder||c.WebKitBlobBuilder,h;if(j){h=new j();h.append(i);return h.getBlob(k)}return new Blob([i],k?{type:k}:{})},canvasToDataUrl:function(h,j,i){return h.toDataURL(j,i/100)},parseMeta:function(h,i){i(false,{})},updateImageHead:function(h){return h}}});a("runtime/html5/imagemeta",["runtime/html5/util"],function(e){var d;d={parsers:{65505:[]},maxMetaDataSize:262144,parse:function(f,g){var i=this,h=new FileReader();h.onload=function(){g(false,i._parse(this.result));h=h.onload=h.onerror=null};h.onerror=function(j){g(j.message);h=h.onload=h.onerror=null};f=f.slice(0,i.maxMetaDataSize);h.readAsArrayBuffer(f.getSource())},_parse:function(f,n){if(f.byteLength<6){return}var g=new DataView(f),o=2,m=g.byteLength-4,h=o,q={},k,l,p,j;if(g.getUint16(0)===65496){while(o<m){k=g.getUint16(o);if(k>=65504&&k<=65519||k===65534){l=g.getUint16(o+2)+2;if(o+l>g.byteLength){break}p=d.parsers[k];if(!n&&p){for(j=0;j<p.length;j+=1){p[j].call(d,g,o,l,q)}}o+=l;h=o}else{break}}if(h>6){if(f.slice){q.imageHead=f.slice(2,h)}else{q.imageHead=new Uint8Array(f).subarray(2,h)}}}return q},updateImageHead:function(i,k){var j=this._parse(i,true),g,h,f;f=2;if(j.imageHead){f=2+j.imageHead.byteLength}if(i.slice){h=i.slice(f)}else{h=new Uint8Array(i).subarray(f)}g=new Uint8Array(k.byteLength+2+h.byteLength);g[0]=255;g[1]=216;g.set(new Uint8Array(k),2);g.set(new Uint8Array(h),k.byteLength+2);return g.buffer}};e.parseMeta=function(){return d.parse.apply(d,arguments)};e.updateImageHead=function(){return d.updateImageHead.apply(d,arguments)};return d});a("runtime/html5/imagemeta/exif",["base","runtime/html5/imagemeta"],function(d,f){var e={};e.ExifMap=function(){return this};e.ExifMap.prototype.map={Orientation:274};e.ExifMap.prototype.get=function(g){return this[g]||this[this.map[g]]};e.exifTagTypes={1:{getValue:function(h,g){return h.getUint8(g)},size:1},2:{getValue:function(h,g){return String.fromCharCode(h.getUint8(g))},size:1,ascii:true},3:{getValue:function(h,g,i){return h.getUint16(g,i)},size:2},4:{getValue:function(h,g,i){return h.getUint32(g,i)},size:4},5:{getValue:function(h,g,i){return h.getUint32(g,i)/h.getUint32(g+4,i)},size:8},9:{getValue:function(h,g,i){return h.getInt32(g,i)},size:4},10:{getValue:function(h,g,i){return h.getInt32(g,i)/h.getInt32(g+4,i)},size:8}};e.exifTagTypes[7]=e.exifTagTypes[1];e.getExifValue=function(j,r,n,s,l,m){var q=e.exifTagTypes[s],p,h,t,k,o,g;if(!q){d.log("Invalid Exif data: Invalid tag type.");return}p=q.size*l;h=p>4?r+j.getUint32(n+8,m):(n+8);if(h+p>j.byteLength){d.log("Invalid Exif data: Invalid data offset.");return}if(l===1){return q.getValue(j,h,m)}t=[];for(k=0;k<l;k+=1){t[k]=q.getValue(j,h+k*q.size,m)}if(q.ascii){o="";for(k=0;k<t.length;k+=1){g=t[k];if(g==="\u0000"){break}o+=g}return o}return t};e.parseExifTag=function(h,l,j,i,g){var k=h.getUint16(j,i);g.exif[k]=e.getExifValue(h,l,j,h.getUint16(j+2,i),h.getUint32(j+4,i),i)};e.parseExifTags=function(h,o,k,m,g){var n,j,l;if(k+6>h.byteLength){d.log("Invalid Exif data: Invalid directory offset.");return}n=h.getUint16(k,m);j=k+2+12*n;if(j+4>h.byteLength){d.log("Invalid Exif data: Invalid directory size.");return}for(l=0;l<n;l+=1){this.parseExifTag(h,o,k+2+12*l,m,g)}return h.getUint32(j,m)};e.parseExifData=function(h,l,j,g){var m=l+10,k,i;if(h.getUint32(l+4)!==1165519206){return}if(m+8>h.byteLength){d.log("Invalid Exif data: Invalid segment size.");return}if(h.getUint16(l+8)!==0){d.log("Invalid Exif data: Missing byte alignment offset.");return}switch(h.getUint16(m)){case 18761:k=true;break;case 19789:k=false;break;default:d.log("Invalid Exif data: Invalid byte alignment marker.");return}if(h.getUint16(m+2,k)!==42){d.log("Invalid Exif data: Missing TIFF marker.");return}i=h.getUint32(m+4,k);g.exif=new e.ExifMap();i=e.parseExifTags(h,m,m+i,k,g)};f.parsers[65505].push(e.parseExifData);return e});a("runtime/html5/jpegencoder",[],function(g,d,f){function e(D){var F=this;var u=Math.round;var t=Math.floor;var af=new Array(64);var S=new Array(64);var s=new Array(64);var r=new Array(64);var ad;var R;var ac;var Q;var h=new Array(65535);var l=new Array(65535);var B=new Array(64);var p=new Array(64);var j=[];var i=0;var k=7;var ae=new Array(64);var P=new Array(64);var T=new Array(64);var m=new Array(256);var E=new Array(2048);var o;var ag=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63];var N=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0];var O=[0,1,2,3,4,5,6,7,8,9,10,11];var J=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125];var K=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250];var L=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0];var M=[0,1,2,3,4,5,6,7,8,9,10,11];var H=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119];var I=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function z(an){var ar=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99];for(var aj=0;aj<64;aj++){var ao=t((ar[aj]*an+50)/100);if(ao<1){ao=1}else{if(ao>255){ao=255}}af[ag[aj]]=ao}var aq=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99];for(var ak=0;ak<64;ak++){var ap=t((aq[ak]*an+50)/100);if(ap<1){ap=1}else{if(ap>255){ap=255}}S[ag[ak]]=ap}var ah=[1,1.387039845,1.306562965,1.175875602,1,0.785694958,0.5411961,0.275899379];var al=0;for(var am=0;am<8;am++){for(var ai=0;ai<8;ai++){s[al]=(1/(af[ag[al]]*ah[am]*ah[ai]*8));r[al]=(1/(S[ag[al]]*ah[am]*ah[ai]*8));al++}}}function n(al,an){var ah=0;var am=0;var ai=new Array();for(var ak=1;ak<=16;ak++){for(var aj=1;aj<=al[ak];aj++){ai[an[am]]=[];ai[an[am]][0]=ah;ai[an[am]][1]=ak;am++;ah++}ah*=2}return ai}function y(){ad=n(N,O);R=n(L,M);ac=n(J,K);Q=n(H,I)}function w(){var aj=1;var al=2;for(var ah=1;ah<=15;ah++){for(var ai=aj;ai<al;ai++){l[32767+ai]=ah;h[32767+ai]=[];h[32767+ai][1]=ah;h[32767+ai][0]=ai}for(var ak=-(al-1);ak<=-aj;ak++){l[32767+ak]=ah;h[32767+ak]=[];h[32767+ak][1]=ah;h[32767+ak][0]=al-1+ak}aj<<=1;al<<=1}}function A(){for(var ah=0;ah<256;ah++){E[ah]=19595*ah;E[(ah+256)>>0]=38470*ah;E[(ah+512)>>0]=7471*ah+32768;E[(ah+768)>>0]=-11059*ah;E[(ah+1024)>>0]=-21709*ah;E[(ah+1280)>>0]=32768*ah+8421375;E[(ah+1536)>>0]=-27439*ah;E[(ah+1792)>>0]=-5329*ah}}function V(ah){var aj=ah[0];var ai=ah[1]-1;while(ai>=0){if(aj&(1<<ai)){i|=(1<<k)}ai--;k--;if(k<0){if(i==255){W(255);W(0)}else{W(i)}k=7;i=0}}}function W(ah){j.push(m[ah])}function ab(ah){W((ah>>8)&255);W((ah)&255)}function q(ap,at){var ah,ai,aj,ak,al,am,an,ao;var aq=0;var au;var aw=8;var av=64;for(au=0;au<aw;++au){ah=ap[aq];ai=ap[aq+1];aj=ap[aq+2];ak=ap[aq+3];al=ap[aq+4];am=ap[aq+5];an=ap[aq+6];ao=ap[aq+7];var ax=ah+ao;var aT=ah-ao;var az=ai+an;var aR=ai-an;var aJ=aj+am;var aP=aj-am;var aL=ak+al;var aN=ak-al;var aA=ax+aL;var aG=ax-aL;var aC=az+aJ;var aE=az-aJ;ap[aq]=aA+aC;ap[aq+4]=aA-aC;var aV=(aE+aG)*0.707106781;ap[aq+2]=aG+aV;ap[aq+6]=aG-aV;aA=aN+aP;aC=aP+aR;aE=aR+aT;var a7=(aA-aE)*0.382683433;var a1=0.5411961*aA+a7;var a5=1.306562965*aE+a7;var a3=aC*0.707106781;var aW=aT+a3;var aY=aT-a3;ap[aq+5]=aY+a1;ap[aq+3]=aY-a1;ap[aq+1]=aW+a5;ap[aq+7]=aW-a5;aq+=8}aq=0;for(au=0;au<aw;++au){ah=ap[aq];ai=ap[aq+8];aj=ap[aq+16];ak=ap[aq+24];al=ap[aq+32];am=ap[aq+40];an=ap[aq+48];ao=ap[aq+56];var ay=ah+ao;var aU=ah-ao;var aI=ai+an;var aS=ai-an;var aK=aj+am;var aQ=aj-am;var aM=ak+al;var aO=ak-al;var aB=ay+aM;var aH=ay-aM;var aD=aI+aK;var aF=aI-aK;ap[aq]=aB+aD;ap[aq+32]=aB-aD;var a0=(aF+aH)*0.707106781;ap[aq+16]=aH+a0;ap[aq+48]=aH-a0;aB=aO+aQ;aD=aQ+aS;aF=aS+aU;var a8=(aB-aF)*0.382683433;var a2=0.5411961*aB+a8;var a6=1.306562965*aF+a8;var a4=aD*0.707106781;var aX=aU+a4;var aZ=aU-a4;ap[aq+40]=aZ+a2;ap[aq+24]=aZ-a2;ap[aq+8]=aX+a6;ap[aq+56]=aX-a6;aq++}var ar;for(au=0;au<av;++au){ar=ap[au]*at[au];B[au]=(ar>0)?((ar+0.5)|0):((ar-0.5)|0)}return B}function U(){ab(65504);ab(16);W(74);W(70);W(73);W(70);W(0);W(1);W(1);W(0);ab(1);ab(1);W(0);W(0)}function Z(ai,ah){ab(65472);ab(17);W(8);ab(ah);ab(ai);W(3);W(1);W(17);W(0);W(2);W(17);W(1);W(3);W(17);W(1)}function Y(){ab(65499);ab(132);W(0);for(var ah=0;ah<64;ah++){W(af[ah])}W(1);for(var ai=0;ai<64;ai++){W(S[ai])}}function X(){ab(65476);ab(418);W(0);for(var ah=0;ah<16;ah++){W(N[ah+1])}for(var ai=0;ai<=11;ai++){W(O[ai])}W(16);for(var aj=0;aj<16;aj++){W(J[aj+1])}for(var ak=0;ak<=161;ak++){W(K[ak])}W(1);for(var al=0;al<16;al++){W(L[al+1])}for(var am=0;am<=11;am++){W(M[am])}W(17);for(var an=0;an<16;an++){W(H[an+1])}for(var ao=0;ao<=161;ao++){W(I[ao])}}function aa(){ab(65498);ab(12);W(3);W(1);W(0);W(2);W(17);W(3);W(17);W(0);W(63);W(0)}function C(ah,an,ai,ap,ao){var am=ao[0];var ax=ao[240];var aA;var ar=16;var at=63;var au=64;var ak=q(ah,an);for(var av=0;av<au;++av){p[ag[av]]=ak[av]}var aj=p[0]-ai;ai=p[0];if(aj==0){V(ap[0])}else{aA=32767+aj;V(ap[l[aA]]);V(h[aA])}var al=63;for(;(al>0)&&(p[al]==0);al--){}if(al==0){V(am);return ai}var aq=1;var aw;while(aq<=al){var aB=aq;for(;(p[aq]==0)&&(aq<=al);++aq){}var az=aq-aB;if(az>=ar){aw=az>>4;for(var ay=1;ay<=aw;++ay){V(ax)}az=az&15}aA=32767+p[aq];V(ao[(az<<4)+l[aA]]);V(h[aA]);aq++}if(al!=at){V(am)}return ai}function x(){var ai=String.fromCharCode;for(var ah=0;ah<256;ah++){m[ah]=ai(ah)}}this.encode=function(ap,aw){if(aw){G(aw)}j=new Array();i=0;k=7;ab(65496);U();Y();Z(ap.width,ap.height);X();aa();var al=0;var aj=0;var ak=0;i=0;k=7;this.encode.displayName="_encode_";var aq=ap.data;var aB=ap.width;var ao=ap.height;var av=aB*4;var aA=aB*3;var aC,aD=0;var ax,an,ah;var az,at,ai,ay,au;while(aD<ao){aC=0;while(aC<av){az=av*aD+aC;at=az;ai=-1;ay=0;for(au=0;au<64;au++){ay=au>>3;ai=(au&7)*4;at=az+(ay*av)+ai;if(aD+ay>=ao){at-=(av*(aD+1+ay-ao))}if(aC+ai>=av){at-=((aC+ai)-av+4)}ax=aq[at++];an=aq[at++];ah=aq[at++];ae[au]=((E[ax]+E[(an+256)>>0]+E[(ah+512)>>0])>>16)-128;P[au]=((E[(ax+768)>>0]+E[(an+1024)>>0]+E[(ah+1280)>>0])>>16)-128;T[au]=((E[(ax+1280)>>0]+E[(an+1536)>>0]+E[(ah+1792)>>0])>>16)-128}al=C(ae,s,al,ad,ac);aj=C(P,r,aj,R,Q);ak=C(T,r,ak,R,Q);aC+=32}aD+=8}if(k>=0){var am=[];am[1]=k+1;am[0]=(1<<(k+1))-1;V(am)}ab(65497);var ar="data:image/jpeg;base64,"+btoa(j.join(""));j=[];return ar};function G(ah){if(ah<=0){ah=1}if(ah>100){ah=100}if(o==ah){return}var ai=0;if(ah<50){ai=Math.floor(5000/ah)}else{ai=Math.floor(200-ah*2)}z(ai);o=ah}function v(){if(!D){D=50}x();y();w();A();G(D)}v()}e.encode=function(h,j){var i=new e(j);return i.encode(h)};return e});a("runtime/html5/androidpatch",["runtime/html5/util","runtime/html5/jpegencoder","base"],function(h,e,d){var f=h.canvasToDataUrl,g;h.canvasToDataUrl=function(i,o,n){var j,p,l,k,m;if(!d.os.android){return f.apply(null,arguments)}if(o==="image/jpeg"&&typeof g==="undefined"){k=f.apply(null,arguments);m=k.split(",");if(~m[0].indexOf("base64")){k=atob(m[1])}else{k=decodeURIComponent(m[1])}k=k.substring(0,2);g=k.charCodeAt(0)===255&&k.charCodeAt(1)===216}if(o==="image/jpeg"&&!g){p=i.width;l=i.height;j=i.getContext("2d");return e.encode(j.getImageData(0,0,p,l),n)}return f.apply(null,arguments)}});a("runtime/html5/image",["base","runtime/html5/runtime","runtime/html5/util"],function(d,f,g){var e="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D";return f.register("Image",{modified:false,init:function(){var i=this,h=new Image();h.onload=function(){i._info={type:i.type,width:this.width,height:this.height};if(!i._metas&&"image/jpeg"===i.type){g.parseMeta(i._blob,function(j,k){i._metas=k;i.owner.trigger("load")})}else{i.owner.trigger("load")}};h.onerror=function(){i.owner.trigger("error")};i._img=h},loadFromBlob:function(h){var j=this,i=j._img;j._blob=h;j.type=h.type;i.src=g.createObjectURL(h.getSource());j.owner.once("load",function(){g.revokeObjectURL(i.src)})},resize:function(j,i){var h=this._canvas||(this._canvas=document.createElement("canvas"));this._resize(this._img,h,j,i);this._blob=null;this.modified=true;this.owner.trigger("complete","resize")},crop:function(r,t,q,j,p){var i=this._canvas||(this._canvas=document.createElement("canvas")),n=this.options,l=this._img,m=l.naturalWidth,k=l.naturalHeight,o=this.getOrientation();p=p||1;i.width=q;i.height=j;n.preserveHeaders||this._rotate2Orientaion(i,o);this._renderImageToCanvas(i,l,-r,-t,m*p,k*p);this._blob=null;this.modified=true;this.owner.trigger("complete","crop")},getAsBlob:function(k){var h=this._blob,j=this.options,i;k=k||this.type;if(this.modified||this.type!==k){i=this._canvas;if(k==="image/jpeg"){h=g.canvasToDataUrl(i,k,j.quality);if(j.preserveHeaders&&this._metas&&this._metas.imageHead){h=g.dataURL2ArrayBuffer(h);h=g.updateImageHead(h,this._metas.imageHead);h=g.arrayBufferToBlob(h,k);return h}}else{h=g.canvasToDataUrl(i,k)}h=g.dataURL2Blob(h)}return h},getAsDataUrl:function(i){var h=this.options;i=i||this.type;if(i==="image/jpeg"){return g.canvasToDataUrl(this._canvas,i,h.quality)}else{return this._canvas.toDataURL(i)}},getOrientation:function(){return this._metas&&this._metas.exif&&this._metas.exif.get("Orientation")||1},info:function(h){if(h){this._info=h;return this}return this._info},meta:function(h){if(h){this._meta=h;return this}return this._meta},destroy:function(){var h=this._canvas;this._img.onload=null;if(h){h.getContext("2d").clearRect(0,0,h.width,h.height);h.width=h.height=0;this._canvas=null}this._img.src=e;this._img=this._blob=null},_resize:function(l,i,s,k){var o=this.options,n=l.width,m=l.height,p=this.getOrientation(),q,r,j,t,u;if(~[5,6,7,8].indexOf(p)){s^=k;k^=s;s^=k}q=Math[o.crop?"max":"min"](s/n,k/m);o.allowMagnify||(q=Math.min(1,q));r=n*q;j=m*q;if(o.crop){i.width=s;i.height=k}else{i.width=r;i.height=j}t=(i.width-r)/2;u=(i.height-j)/2;o.preserveHeaders||this._rotate2Orientaion(i,p);this._renderImageToCanvas(i,l,t,u,r,j)},_rotate2Orientaion:function(h,k){var l=h.width,j=h.height,i=h.getContext("2d");switch(k){case 5:case 6:case 7:case 8:h.width=j;h.height=l;break}switch(k){case 2:i.translate(l,0);i.scale(-1,1);break;case 3:i.translate(l,j);i.rotate(Math.PI);break;case 4:i.translate(0,j);i.scale(1,-1);break;case 5:i.rotate(0.5*Math.PI);i.scale(1,-1);break;case 6:i.rotate(0.5*Math.PI);i.translate(0,-j);break;case 7:i.rotate(0.5*Math.PI);i.translate(l,-j);i.scale(-1,1);break;case 8:i.rotate(-0.5*Math.PI);i.translate(-l,0);break}},_renderImageToCanvas:(function(){if(!d.os.ios){return function(k){var j=d.slice(arguments,1),l=k.getContext("2d");l.drawImage.apply(l,j)}}function i(p,q,o){var k=document.createElement("canvas"),l=k.getContext("2d"),t=0,n=o,r=o,m,j,s;k.width=1;k.height=o;l.drawImage(p,0,0);m=l.getImageData(0,0,1,o).data;while(r>t){j=m[(r-1)*4+3];if(j===0){n=r}else{t=r}r=(n+t)>>1}s=(r/o);return(s===0)?1:s}if(d.os.ios>=7){return function(j,m,q,r,p,k){var n=m.naturalWidth,l=m.naturalHeight,o=i(m,n,l);return j.getContext("2d").drawImage(m,0,0,n*o,l*o,q,r,p,k)}}function h(m){var n=m.naturalWidth,l=m.naturalHeight,j,k;if(n*l>1024*1024){j=document.createElement("canvas");j.width=j.height=1;k=j.getContext("2d");k.drawImage(m,-n+1,0);return k.getImageData(0,0,1,1).data[3]===0}else{return false}}return function(j,t,E,F,D,r){var u=t.naturalWidth,s=t.naturalHeight,k=j.getContext("2d"),v=h(t),n=this.type==="image/jpeg",l=1024,z=0,q=0,A,B,C,o,m,w,p;if(v){u/=2;s/=2}k.save();A=document.createElement("canvas");A.width=A.height=l;B=A.getContext("2d");C=n?i(t,u,s):1;o=Math.ceil(l*D/u);m=Math.ceil(l*r/s/C);while(z<s){w=0;p=0;while(w<u){B.clearRect(0,0,l,l);B.drawImage(t,-w,-z);k.drawImage(A,0,0,l,l,E+p,F+q,o,m);w+=l;p+=o}z+=l;q+=m}k.restore();A=B=null}})()})});a("runtime/html5/transport",["base","runtime/html5/runtime"],function(e,f){var g=e.noop,d=e.$;return f.register("Transport",{init:function(){this._status=0;this._response=null},send:function(){var m=this.owner,l=this.options,o=this._initAjax(),i=m._blob,n=l.server,j,h,k;if(l.sendAsBinary){n+=(/\?/.test(n)?"&":"?")+d.param(m._formData);h=i.getSource()}else{j=new FormData();d.each(m._formData,function(p,q){j.append(p,q)});j.append(l.fileVal,i.getSource(),l.filename||m._formData.name||"")}if(l.withCredentials&&"withCredentials" in o){o.open(l.method,n,true);o.withCredentials=true}else{o.open(l.method,n)}this._setRequestHeader(o,l.headers);if(h){o.overrideMimeType&&o.overrideMimeType("application/octet-stream");if(e.os.android){k=new FileReader();k.onload=function(){o.send(this.result);k=k.onload=null};k.readAsArrayBuffer(h)}else{o.send(h)}}else{o.send(j)}},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var h=this._xhr;if(h){h.upload.onprogress=g;h.onreadystatechange=g;h.abort();this._xhr=h=null}},destroy:function(){this.abort()},_initAjax:function(){var h=this,j=new XMLHttpRequest(),i=this.options;if(i.withCredentials&&!("withCredentials" in j)&&typeof XDomainRequest!=="undefined"){j=new XDomainRequest()}j.upload.onprogress=function(k){var l=0;if(k.lengthComputable){l=k.loaded/k.total}return h.trigger("progress",l)};j.onreadystatechange=function(){if(j.readyState!==4){return}j.upload.onprogress=g;j.onreadystatechange=g;h._xhr=null;h._status=j.status;if(j.status>=200&&j.status<300){h._response=j.responseText;return h.trigger("load")}else{if(j.status>=500&&j.status<600){h._response=j.responseText;return h.trigger("error","server")}}return h.trigger("error",h._status?"http":"abort")};h._xhr=j;return j},_setRequestHeader:function(i,h){d.each(h,function(j,k){i.setRequestHeader(j,k)})},_parseJson:function(j){var i;try{i=JSON.parse(j)}catch(h){i={}}return i}})});a("runtime/html5/md5",["runtime/html5/runtime"],function(g){var d=function(u,v){return(u+v)&4294967295},e=function(w,u,v,A,y,z){u=d(d(u,w),d(A,z));return d((u<<y)|(u>>>(32-y)),v)},f=function(u,v,w,y,B,z,A){return e((v&w)|((~v)&y),u,v,B,z,A)},h=function(u,v,w,y,B,z,A){return e((v&y)|(w&(~y)),u,v,B,z,A)},k=function(u,v,w,y,B,z,A){return e(v^w^y,u,v,B,z,A)},l=function(u,v,w,y,B,z,A){return e(w^(v|(~y)),u,v,B,z,A)},r=function(A,z){var u=A[0],v=A[1],w=A[2],y=A[3];u=f(u,v,w,y,z[0],7,-680876936);y=f(y,u,v,w,z[1],12,-389564586);w=f(w,y,u,v,z[2],17,606105819);v=f(v,w,y,u,z[3],22,-1044525330);u=f(u,v,w,y,z[4],7,-176418897);y=f(y,u,v,w,z[5],12,1200080426);w=f(w,y,u,v,z[6],17,-1473231341);v=f(v,w,y,u,z[7],22,-45705983);u=f(u,v,w,y,z[8],7,1770035416);y=f(y,u,v,w,z[9],12,-1958414417);w=f(w,y,u,v,z[10],17,-42063);v=f(v,w,y,u,z[11],22,-1990404162);u=f(u,v,w,y,z[12],7,1804603682);y=f(y,u,v,w,z[13],12,-40341101);w=f(w,y,u,v,z[14],17,-1502002290);v=f(v,w,y,u,z[15],22,1236535329);u=h(u,v,w,y,z[1],5,-165796510);y=h(y,u,v,w,z[6],9,-1069501632);w=h(w,y,u,v,z[11],14,643717713);v=h(v,w,y,u,z[0],20,-373897302);u=h(u,v,w,y,z[5],5,-701558691);y=h(y,u,v,w,z[10],9,38016083);w=h(w,y,u,v,z[15],14,-660478335);v=h(v,w,y,u,z[4],20,-405537848);u=h(u,v,w,y,z[9],5,568446438);y=h(y,u,v,w,z[14],9,-1019803690);w=h(w,y,u,v,z[3],14,-187363961);v=h(v,w,y,u,z[8],20,1163531501);u=h(u,v,w,y,z[13],5,-1444681467);y=h(y,u,v,w,z[2],9,-51403784);w=h(w,y,u,v,z[7],14,1735328473);v=h(v,w,y,u,z[12],20,-1926607734);u=k(u,v,w,y,z[5],4,-378558);y=k(y,u,v,w,z[8],11,-2022574463);w=k(w,y,u,v,z[11],16,1839030562);v=k(v,w,y,u,z[14],23,-35309556);u=k(u,v,w,y,z[1],4,-1530992060);y=k(y,u,v,w,z[4],11,1272893353);w=k(w,y,u,v,z[7],16,-155497632);v=k(v,w,y,u,z[10],23,-1094730640);u=k(u,v,w,y,z[13],4,681279174);y=k(y,u,v,w,z[0],11,-358537222);w=k(w,y,u,v,z[3],16,-722521979);v=k(v,w,y,u,z[6],23,76029189);u=k(u,v,w,y,z[9],4,-640364487);y=k(y,u,v,w,z[12],11,-421815835);w=k(w,y,u,v,z[15],16,530742520);v=k(v,w,y,u,z[2],23,-995338651);u=l(u,v,w,y,z[0],6,-198630844);y=l(y,u,v,w,z[7],10,1126891415);w=l(w,y,u,v,z[14],15,-1416354905);v=l(v,w,y,u,z[5],21,-57434055);u=l(u,v,w,y,z[12],6,1700485571);y=l(y,u,v,w,z[3],10,-1894986606);w=l(w,y,u,v,z[10],15,-1051523);v=l(v,w,y,u,z[1],21,-2054922799);u=l(u,v,w,y,z[8],6,1873313359);y=l(y,u,v,w,z[15],10,-30611744);w=l(w,y,u,v,z[6],15,-1560198380);v=l(v,w,y,u,z[13],21,1309151649);u=l(u,v,w,y,z[4],6,-145523070);y=l(y,u,v,w,z[11],10,-1120210379);w=l(w,y,u,v,z[2],15,718787259);v=l(v,w,y,u,z[9],21,-343485551);A[0]=d(u,A[0]);A[1]=d(v,A[1]);A[2]=d(w,A[2]);A[3]=d(y,A[3])},p=function(w){var v=[],u;for(u=0;u<64;u+=4){v[u>>2]=w.charCodeAt(u)+(w.charCodeAt(u+1)<<8)+(w.charCodeAt(u+2)<<16)+(w.charCodeAt(u+3)<<24)}return v},q=function(u){var w=[],v;for(v=0;v<64;v+=4){w[v>>2]=u[v]+(u[v+1]<<8)+(u[v+2]<<16)+(u[v+3]<<24)}return w},n=function(z){var y=z.length,A=[1732584193,-271733879,-1732584194,271733878],v,w,B,C,x,u;for(v=64;v<=y;v+=64){r(A,p(z.substring(v-64,v)))}z=z.substring(v-64);w=z.length;B=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(v=0;v<w;v+=1){B[v>>2]|=z.charCodeAt(v)<<((v%4)<<3)}B[v>>2]|=128<<((v%4)<<3);if(v>55){r(A,B);for(v=0;v<16;v+=1){B[v]=0}}C=y*8;C=C.toString(16).match(/(.*?)(.{0,8})$/);x=parseInt(C[2],16);u=parseInt(C[1],16)||0;B[14]=x;B[15]=u;r(A,B);return A},o=function(u){var z=u.length,A=[1732584193,-271733879,-1732584194,271733878],w,x,B,C,y,v;for(w=64;w<=z;w+=64){r(A,q(u.subarray(w-64,w)))}u=(w-64)<z?u.subarray(w-64):new Uint8Array(0);x=u.length;B=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(w=0;w<x;w+=1){B[w>>2]|=u[w]<<((w%4)<<3)}B[w>>2]|=128<<((w%4)<<3);if(w>55){r(A,B);for(w=0;w<16;w+=1){B[w]=0}}C=z*8;C=C.toString(16).match(/(.*?)(.{0,8})$/);y=parseInt(C[2],16);v=parseInt(C[1],16)||0;B[14]=y;B[15]=v;r(A,B);return A},j=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],s=function(v){var w="",u;for(u=0;u<4;u+=1){w+=j[(v>>(u*8+4))&15]+j[(v>>(u*8))&15]}return w},i=function(v){var u;for(u=0;u<v.length;u+=1){v[u]=s(v[u])}return v.join("")},m=function(u){return i(n(u))},t=function(){this.reset()};if(m("hello")!=="5d41402abc4b2a76b9719d911017c592"){d=function(w,z){var u=(w&65535)+(z&65535),v=(w>>16)+(z>>16)+(u>>16);return(v<<16)|(u&65535)}}t.prototype.append=function(u){if(/[\u0080-\uFFFF]/.test(u)){u=unescape(encodeURIComponent(u))}this.appendBinary(u);return this};t.prototype.appendBinary=function(u){this._buff+=u;this._length+=u.length;var w=this._buff.length,v;for(v=64;v<=w;v+=64){r(this._state,p(this._buff.substring(v-64,v)))}this._buff=this._buff.substr(v-64);return this};t.prototype.end=function(x){var u=this._buff,w=u.length,v,z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],y;for(v=0;v<w;v+=1){z[v>>2]|=u.charCodeAt(v)<<((v%4)<<3)}this._finish(z,w);y=!!x?this._state:i(this._state);this.reset();return y};t.prototype._finish=function(y,w){var v=w,z,x,u;y[v>>2]|=128<<((v%4)<<3);if(v>55){r(this._state,y);for(v=0;v<16;v+=1){y[v]=0}}z=this._length*8;z=z.toString(16).match(/(.*?)(.{0,8})$/);x=parseInt(z[2],16);u=parseInt(z[1],16)||0;y[14]=x;y[15]=u;r(this._state,y)};t.prototype.reset=function(){this._buff="";this._length=0;this._state=[1732584193,-271733879,-1732584194,271733878];return this};t.prototype.destroy=function(){delete this._state;delete this._buff;delete this._length};t.hash=function(w,v){if(/[\u0080-\uFFFF]/.test(w)){w=unescape(encodeURIComponent(w))}var u=n(w);return !!v?u:i(u)};t.hashBinary=function(u,w){var v=n(u);return !!w?v:i(v)};t.ArrayBuffer=function(){this.reset()};t.ArrayBuffer.prototype.append=function(u){var v=this._concatArrayBuffer(this._buff,u),x=v.length,w;this._length+=u.byteLength;for(w=64;w<=x;w+=64){r(this._state,q(v.subarray(w-64,w)))}this._buff=(w-64)<x?v.subarray(w-64):new Uint8Array(0);return this};t.ArrayBuffer.prototype.end=function(x){var u=this._buff,w=u.length,z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],v,y;for(v=0;v<w;v+=1){z[v>>2]|=u[v]<<((v%4)<<3)}this._finish(z,w);y=!!x?this._state:i(this._state);this.reset();return y};t.ArrayBuffer.prototype._finish=t.prototype._finish;t.ArrayBuffer.prototype.reset=function(){this._buff=new Uint8Array(0);this._length=0;this._state=[1732584193,-271733879,-1732584194,271733878];return this};t.ArrayBuffer.prototype.destroy=t.prototype.destroy;t.ArrayBuffer.prototype._concatArrayBuffer=function(u,x){var v=u.length,w=new Uint8Array(v+x.byteLength);w.set(u);w.set(new Uint8Array(x),v);return w};t.ArrayBuffer.hash=function(u,w){var v=o(new Uint8Array(u));return !!w?v:i(v)};return g.register("Md5",{init:function(){},loadFromBlob:function(z){var u=z.getSource(),y=2*1024*1024,x=Math.ceil(u.size/y),w=0,D=this.owner,E=new t.ArrayBuffer(),C=this,v=u.mozSlice||u.webkitSlice||u.slice,B,A;A=new FileReader();B=function(){var G,F;G=w*y;F=Math.min(G+y,u.size);A.onload=function(H){E.append(H.target.result);D.trigger("progress",{total:z.size,loaded:F})};A.onloadend=function(){A.onloadend=A.onload=null;if(++w<x){setTimeout(B,1)}else{setTimeout(function(){D.trigger("load");C.result=E.end();B=z=u=E=null;D.trigger("complete")},50)}};A.readAsArrayBuffer(v.call(u,G,F))};B()},getResult:function(){return this.result}})});a("runtime/flash/runtime",["base","runtime/runtime","runtime/compbase"],function(e,j,f){var d=e.$,k="flash",g={};function i(){var n;try{n=navigator.plugins["Shockwave Flash"];n=n.description}catch(l){try{n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(m){n="0.0"}}n=n.match(/\d+/g);return parseFloat(n[0]+"."+n[1],10)}function h(){var q={},l={},m=this.destroy,p=this,o=e.guid("webuploader_");j.apply(p,arguments);p.type=k;p.exec=function(t,u){var s=this,w=s.uid,r=e.slice(arguments,2),v;l[w]=s;if(g[t]){if(!q[w]){q[w]=new g[t](s,p)}v=q[w];if(v[u]){return v[u].apply(v,r)}}return p.flashExec.apply(s,arguments)};function n(r,s){var u=r.type||r,t,v;t=u.split("::");v=t[0];u=t[1];if(u==="Ready"&&v===p.uid){p.trigger("ready")}else{if(l[v]){l[v].trigger(u.toLowerCase(),r,s)}}}c[o]=function(){var r=arguments;setTimeout(function(){n.apply(null,r)},1)};this.jsreciver=o;this.destroy=function(){return m&&m.apply(this,arguments)};this.flashExec=function(s,u){var t=p.getFlash(),r=e.slice(arguments,2);return t.exec(this.uid,s,u,r)}}e.inherits(j,{constructor:h,init:function(){var l=this.getContainer(),n=this.options,m;l.css({position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});m='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+n.swf+'" ';if(e.browser.ie){m+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '}m+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+n.swf+'" /><param name="flashvars" value="uid='+this.uid+"&jsreciver="+this.jsreciver+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>';l.html(m)},getFlash:function(){if(this._flash){return this._flash}this._flash=d("#"+this.uid).get(0);return this._flash}});h.register=function(m,l){l=g[m]=e.inherits(f,d.extend({flashExec:function(){var n=this.owner,o=this.getRuntime();return o.flashExec.apply(n,arguments)}},l));return l};if(i()>=11.4){j.addRuntime(k,h)}return h});a("runtime/flash/filepicker",["base","runtime/flash/runtime"],function(e,f){var d=e.$;return f.register("FilePicker",{init:function(k){var g=d.extend({},k),j,h;j=g.accept&&g.accept.length;for(h=0;h<j;h++){if(!g.accept[h].title){g.accept[h].title="Files"}}delete g.button;delete g.id;delete g.container;this.flashExec("FilePicker","init",g)},destroy:function(){this.flashExec("FilePicker","destroy")}})});a("runtime/flash/image",["runtime/flash/runtime"],function(d){return d.register("Image",{loadFromBlob:function(e){var f=this.owner;f.info()&&this.flashExec("Image","info",f.info());f.meta()&&this.flashExec("Image","meta",f.meta());this.flashExec("Image","loadFromBlob",e.uid)}})});a("runtime/flash/transport",["base","runtime/flash/runtime","runtime/client"],function(e,f,g){var d=e.$;return f.register("Transport",{init:function(){this._status=0;this._response=null;this._responseJson=null},send:function(){var k=this.owner,j=this.options,m=this._initAjax(),i=k._blob,l=j.server,h;m.connectRuntime(i.ruid);if(j.sendAsBinary){l+=(/\?/.test(l)?"&":"?")+d.param(k._formData);h=i.uid}else{d.each(k._formData,function(n,o){m.exec("append",n,o)});m.exec("appendBlob",j.fileVal,i.uid,j.filename||k._formData.name||"")}this._setRequestHeader(m,j.headers);m.exec("send",{method:j.method,url:l,forceURLStream:j.forceURLStream,mimeType:"application/octet-stream"},h)},getStatus:function(){return this._status},getResponse:function(){return this._response||""},getResponseAsJson:function(){return this._responseJson},abort:function(){var h=this._xhr;if(h){h.exec("abort");h.destroy();this._xhr=h=null}},destroy:function(){this.abort()},_initAjax:function(){var h=this,i=new g("XMLHttpRequest");i.on("uploadprogress progress",function(j){var k=j.loaded/j.total;k=Math.min(1,Math.max(0,k));return h.trigger("progress",k)});i.on("load",function(){var m=i.exec("getStatus"),l=false,j="",k;i.off();h._xhr=null;if(m>=200&&m<300){l=true}else{if(m>=500&&m<600){l=true;j="server"}else{j="http"}}if(l){h._response=i.exec("getResponse");h._response=decodeURIComponent(h._response);k=c.JSON&&c.JSON.parse||function(o){try{return new Function("return "+o).call()}catch(n){return{}}};h._responseJson=h._response?k(h._response):{}}i.destroy();i=null;return j?h.trigger("error",j):h.trigger("load")});i.on("error",function(){i.off();h._xhr=null;h.trigger("error","http")});h._xhr=i;return i},_setRequestHeader:function(i,h){d.each(h,function(j,k){i.exec("setRequestHeader",j,k)})}})});a("runtime/flash/blob",["runtime/flash/runtime","lib/blob"],function(e,d){return e.register("Blob",{slice:function(h,g){var f=this.flashExec("Blob","slice",h,g);return new d(f.uid,f)}})});a("runtime/flash/md5",["runtime/flash/runtime"],function(d){return d.register("Md5",{init:function(){},loadFromBlob:function(e){return this.flashExec("Md5","loadFromBlob",e.uid)}})});a("preset/all",["base","widgets/filednd","widgets/filepaste","widgets/filepicker","widgets/image","widgets/queue","widgets/runtime","widgets/upload","widgets/validator","widgets/md5","runtime/html5/blob","runtime/html5/dnd","runtime/html5/filepaste","runtime/html5/filepicker","runtime/html5/imagemeta/exif","runtime/html5/androidpatch","runtime/html5/image","runtime/html5/transport","runtime/html5/md5","runtime/flash/filepicker","runtime/flash/image","runtime/flash/transport","runtime/flash/blob","runtime/flash/md5"],function(d){return d});a("widgets/log",["base","uploader","widgets/widget"],function(f,k){var d=f.$,h=" http://static.tieba.baidu.com/tb/pms/img/st.gif??",i=(location.hostname||location.host||"protected").toLowerCase(),g=i&&/baidu/i.exec(i),e;if(!g){return}e={dv:3,master:"webuploader",online:/test/.exec(i)?0:1,module:"",product:i,type:0};function j(l){var n=d.extend({},e,l),o=h.replace(/^(.*)\?/,"$1"+d.param(n)),m=new Image();m.src=o}return k.register({name:"log",init:function(){var m=this.owner,l=0,n=0;m.on("error",function(o){j({type:2,c_error_code:o})}).on("uploadError",function(o,p){j({type:2,c_error_code:"UPLOAD_ERROR",c_reason:""+p})}).on("uploadComplete",function(o){l++;n+=o.size}).on("uploadFinished",function(){j({c_count:l,c_size:n});l=n=0});j({c_usage:1})}})});a("webuploader",["preset/all","widgets/log"],function(d){return d});return b("webuploader")});